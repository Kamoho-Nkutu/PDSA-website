<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDSA Veterinary Clinic - Admin Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-storage.js"></script>
    <style>
        :root {
            --primary: #2563eb;
            --primary-dark: #1d4ed8;
            --primary-light: #dbeafe;
            --secondary: #10b981;
            --secondary-dark: #059669;
            --accent: #ef4444;
            --accent-dark: #dc2626;
            --warning: #f59e0b;
            --warning-dark: #d97706;
            --success: #10b981;
            --success-dark: #059669;
            --info: #3b82f6;
            --info-dark: #2563eb;
            --light: #f8fafc;
            --dark: #1e293b;
            --gray-50: #f8fafc;
            --gray-100: #f1f5f9;
            --gray-200: #e2e8f0;
            --gray-300: #cbd5e1;
            --gray-400: #94a3b8;
            --gray-500: #64748b;
            --gray-600: #475569;
            --gray-700: #334155;
            --gray-800: #1e293b;
            --gray-900: #0f172a;
            --sidebar-width: 280px;
            --sidebar-collapsed: 80px;
            --header-height: 70px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-md: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --shadow-lg: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            --radius: 8px;
            --radius-lg: 12px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--gray-50);
            color: var(--gray-800);
            line-height: 1.6;
            overflow-x: hidden;
        }

        /* Login Page Styles */
        .login-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            padding: 1rem;
        }

        .login-card {
            background: white;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-lg);
            width: 100%;
            max-width: 420px;
            overflow: hidden;
        }

        .login-header {
            padding: 2rem 2rem 1rem;
            text-align: center;
            background: var(--primary);
            color: white;
        }

        .login-header img {
            height: 60px;
            margin-bottom: 1rem;
        }

        .login-header h1 {
            font-size: 1.5rem;
            font-weight: 600;
        }

        .login-body {
            padding: 2rem;
        }

        .login-footer {
            padding: 1rem 2rem;
            text-align: center;
            background: var(--gray-50);
            color: var(--gray-600);
            font-size: 0.9rem;
        }

        .form-group {
            margin-bottom: 1.25rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--gray-700);
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 1px solid var(--gray-300);
            border-radius: var(--radius);
            font-size: 0.95rem;
            transition: var(--transition);
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: var(--radius);
            cursor: pointer;
            font-weight: 500;
            font-size: 0.9rem;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background-color: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--primary-dark);
        }

        .btn-secondary {
            background-color: var(--gray-200);
            color: var(--gray-700);
        }

        .btn-secondary:hover {
            background-color: var(--gray-300);
        }

        .btn-block {
            width: 100%;
            justify-content: center;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Toast notifications */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 1rem 1.25rem;
            border-radius: var(--radius);
            color: white;
            z-index: 10000;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: var(--shadow-lg);
            transform: translateX(100%);
            transition: transform 0.3s ease;
            max-width: 350px;
        }

        .toast.show {
            transform: translateX(0);
        }

        .toast.success {
            background-color: var(--success);
        }

        .toast.error {
            background-color: var(--accent);
        }

        .toast.info {
            background-color: var(--info);
        }

        .toast.warning {
            background-color: var(--warning);
        }

        /* Tabs */
        .auth-tabs {
            display: flex;
            margin-bottom: 1.5rem;
            border-radius: var(--radius);
            overflow: hidden;
            background: var(--gray-100);
        }

        .auth-tab {
            flex: 1;
            padding: 0.75rem;
            text-align: center;
            background: none;
            border: none;
            cursor: pointer;
            font-weight: 500;
            color: var(--gray-600);
            transition: var(--transition);
        }

        .auth-tab.active {
            background: var(--primary);
            color: white;
        }

        .auth-form {
            display: none;
        }

        .auth-form.active {
            display: block;
        }

        /* Layout */
        .admin-container {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar */
        .admin-sidebar {
            width: var(--sidebar-width);
            background: linear-gradient(180deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            position: fixed;
            height: 100vh;
            transition: var(--transition);
            z-index: 1000;
            box-shadow: var(--shadow-lg);
            overflow-y: auto;
        }

        .admin-sidebar.collapsed {
            width: var(--sidebar-collapsed);
        }

        .sidebar-header {
            padding: 1.5rem 1.25rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            gap: 12px;
            transition: var(--transition);
        }

        .admin-sidebar.collapsed .sidebar-header {
            justify-content: center;
            padding: 1.5rem 0.5rem;
        }

        .sidebar-header img {
            height: 40px;
            transition: var(--transition);
        }

        .admin-sidebar.collapsed .sidebar-header img {
            height: 35px;
        }

        .sidebar-header h2 {
            font-size: 1.25rem;
            font-weight: 600;
            white-space: nowrap;
            transition: var(--transition);
            opacity: 1;
        }

        .admin-sidebar.collapsed .sidebar-header h2 {
            opacity: 0;
            width: 0;
        }

        .sidebar-menu {
            padding: 1.5rem 0;
        }

        .menu-label {
            margin: 1rem 1.5rem 0.75rem;
            text-transform: uppercase;
            font-size: 0.75rem;
            color: rgba(255, 255, 255, 0.6);
            letter-spacing: 0.5px;
            font-weight: 500;
            transition: var(--transition);
            white-space: nowrap;
        }

        .admin-sidebar.collapsed .menu-label {
            opacity: 0;
            height: 0;
            margin: 0;
            overflow: hidden;
        }

        .menu-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 0.9rem 1.5rem;
            color: rgba(255, 255, 255, 0.8);
            text-decoration: none;
            transition: var(--transition);
            border-left: 4px solid transparent;
            position: relative;
            white-space: nowrap;
        }

        .menu-item:hover {
            background-color: rgba(255, 255, 255, 0.05);
            color: white;
            border-left-color: rgba(255, 255, 255, 0.3);
        }

        .menu-item.active {
            background-color: rgba(255, 255, 255, 0.1);
            color: white;
            border-left-color: white;
        }

        .menu-item i {
            width: 20px;
            text-align: center;
            font-size: 1.1rem;
            transition: var(--transition);
        }

        .admin-sidebar.collapsed .menu-item {
            padding: 0.9rem 1rem;
            justify-content: center;
        }

        .admin-sidebar.collapsed .menu-item span {
            opacity: 0;
            width: 0;
            position: absolute;
            left: 100%;
            background: var(--dark);
            padding: 0.75rem 1rem;
            border-radius: var(--radius);
            box-shadow: var(--shadow-md);
            white-space: nowrap;
            pointer-events: none;
            transition: opacity 0.2s;
        }

        .admin-sidebar.collapsed .menu-item:hover span {
            opacity: 1;
            width: auto;
        }

        /* Main Content */
        .admin-main {
            flex: 1;
            margin-left: var(--sidebar-width);
            transition: var(--transition);
        }

        .admin-main.expanded {
            margin-left: var(--sidebar-collapsed);
        }

        /* Header */
        .admin-header {
            background-color: white;
            height: var(--header-height);
            padding: 0 1.5rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: var(--shadow-sm);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-left {
            display: flex;
            align-items: center;
        }

        .toggle-sidebar {
            background: none;
            border: none;
            font-size: 1.2rem;
            cursor: pointer;
            color: var(--gray-600);
            margin-right: 1rem;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }

        .toggle-sidebar:hover {
            background-color: var(--gray-100);
            color: var(--primary);
        }

        .search-box {
            position: relative;
        }

        .search-box input {
            padding: 0.75rem 1rem 0.75rem 2.75rem;
            border: 1px solid var(--gray-200);
            border-radius: 50px;
            width: 320px;
            transition: var(--transition);
            font-size: 0.9rem;
            background-color: var(--gray-50);
        }

        .search-box input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
            background-color: white;
        }

        .search-box i {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray-400);
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 1.25rem;
        }

        .header-action {
            position: relative;
            cursor: pointer;
            color: var(--gray-600);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }

        .header-action:hover {
            background-color: var(--gray-100);
            color: var(--primary);
        }

        .notification-badge {
            position: absolute;
            top: 2px;
            right: 2px;
            background-color: var(--accent);
            color: white;
            font-size: 0.7rem;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            padding: 0.25rem 0.5rem 0.25rem 0.25rem;
            border-radius: 50px;
            transition: var(--transition);
        }

        .user-profile:hover {
            background-color: var(--gray-100);
        }

        .user-profile img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid var(--primary-light);
        }

        .user-info {
            display: flex;
            flex-direction: column;
        }

        .user-name {
            font-weight: 600;
            font-size: 0.9rem;
        }

        .user-role {
            font-size: 0.75rem;
            color: var(--gray-500);
        }

        /* Dashboard Content */
        .admin-content {
            padding: 1.5rem;
        }

        .page-title {
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .page-title h1 {
            color: var(--gray-800);
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 700;
            font-size: 1.75rem;
        }

        .breadcrumb {
            display: flex;
            align-items: center;
            gap: 5px;
            color: var(--gray-500);
            font-size: 0.9rem;
        }

        .breadcrumb a {
            color: var(--primary);
            text-decoration: none;
            transition: var(--transition);
        }

        .breadcrumb a:hover {
            color: var(--primary-dark);
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .stat-card {
            background-color: white;
            border-radius: var(--radius-lg);
            padding: 1.5rem;
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            gap: 1rem;
            position: relative;
            overflow: hidden;
            transition: var(--transition);
            border: 1px solid var(--gray-100);
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
        }

        .stat-card:nth-child(1)::before { background: linear-gradient(to bottom, var(--primary), var(--primary-dark)); }
        .stat-card:nth-child(2)::before { background: linear-gradient(to bottom, var(--success), var(--success-dark)); }
        .stat-card:nth-child(3)::before { background: linear-gradient(to bottom, var(--accent), var(--accent-dark)); }
        .stat-card:nth-child(4)::before { background: linear-gradient(to bottom, var(--warning), var(--warning-dark)); }

        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .stat-icon.appointments {
            background-color: rgba(37, 99, 235, 0.1);
            color: var(--primary);
        }

        .stat-icon.revenue {
            background-color: rgba(16, 185, 129, 0.1);
            color: var(--success);
        }

        .stat-icon.patients {
            background-color: rgba(239, 68, 68, 0.1);
            color: var(--accent);
        }

        .stat-icon.products {
            background-color: rgba(245, 158, 11, 0.1);
            color: var(--warning);
        }

        .stat-info {
            flex: 1;
        }

        .stat-info h3 {
            font-size: 1.75rem;
            margin-bottom: 0.25rem;
            color: var(--gray-800);
            font-weight: 700;
        }

        .stat-info p {
            color: var(--gray-500);
            font-size: 0.9rem;
            font-weight: 500;
        }

        .stat-trend {
            text-align: right;
        }

        .trend-up {
            color: var(--success);
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            gap: 4px;
            font-size: 0.9rem;
        }

        .trend-down {
            color: var(--accent);
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            gap: 4px;
            font-size: 0.9rem;
        }

        /* Charts and Graphs */
        .charts-container {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .chart-card {
            background-color: white;
            border-radius: var(--radius-lg);
            padding: 1.5rem;
            box-shadow: var(--shadow);
            border: 1px solid var(--gray-100);
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .chart-header h3 {
            color: var(--gray-800);
            font-weight: 600;
        }

        .chart-filter select {
            padding: 0.5rem 1rem;
            border: 1px solid var(--gray-200);
            border-radius: var(--radius);
            background-color: white;
            font-size: 0.9rem;
            color: var(--gray-700);
        }

        .chart-container {
            height: 300px;
            position: relative;
        }

        /* Recent Activity */
        .activity-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .activity-card {
            background-color: white;
            border-radius: var(--radius-lg);
            padding: 1.5rem;
            box-shadow: var(--shadow);
            border: 1px solid var(--gray-100);
        }

        .activity-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 0.75rem;
            border-bottom: 1px solid var(--gray-100);
        }

        .activity-header h3 {
            color: var(--gray-800);
            font-weight: 600;
            font-size: 1.2rem;
        }

        .view-all {
            color: var(--primary);
            text-decoration: none;
            font-size: 0.9rem;
            font-weight: 500;
            transition: var(--transition);
        }

        .view-all:hover {
            color: var(--primary-dark);
        }

        .activity-list {
            list-style: none;
            max-height: 400px;
            overflow-y: auto;
        }

        .activity-item {
            display: flex;
            gap: 1rem;
            padding: 1rem 0;
            border-bottom: 1px solid var(--gray-100);
            animation: fadeIn 0.5s ease;
        }

        .activity-item:last-child {
            border-bottom: none;
        }

        .activity-icon {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            font-size: 1.1rem;
        }

        .activity-icon.appointment {
            background-color: rgba(37, 99, 235, 0.1);
            color: var(--primary);
        }

        .activity-icon.payment {
            background-color: rgba(16, 185, 129, 0.1);
            color: var(--success);
        }

        .activity-icon.registration {
            background-color: rgba(245, 158, 11, 0.1);
            color: var(--warning);
        }

        .activity-content {
            flex: 1;
        }

        .activity-content p {
            margin-bottom: 0.25rem;
            font-weight: 500;
        }

        .activity-content .time {
            font-size: 0.8rem;
            color: var(--gray-500);
        }

        /* Tables */
        .table-card {
            background-color: white;
            border-radius: var(--radius-lg);
            padding: 1.5rem;
            box-shadow: var(--shadow);
            margin-bottom: 1.5rem;
            overflow-x: auto;
            border: 1px solid var(--gray-100);
        }

        .table-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.25rem;
        }

        .table-header h3 {
            color: var(--gray-800);
            font-weight: 600;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        table th, table td {
            padding: 0.875rem 1rem;
            text-align: left;
            border-bottom: 1px solid var(--gray-100);
        }

        table th {
            background-color: var(--gray-50);
            font-weight: 600;
            color: var(--gray-700);
            font-size: 0.9rem;
        }

        table tr {
            transition: var(--transition);
        }

        table tr:hover {
            background-color: var(--gray-50);
        }

        table tr.new-item {
            background-color: rgba(37, 99, 235, 0.03);
            animation: highlight 2s ease;
        }

        .status {
            padding: 0.35rem 0.75rem;
            border-radius: 50px;
            font-size: 0.8rem;
            font-weight: 600;
            display: inline-block;
        }

        .status.confirmed {
            background-color: rgba(16, 185, 129, 0.1);
            color: var(--success);
        }

        .status.pending {
            background-color: rgba(245, 158, 11, 0.1);
            color: var(--warning);
        }

        .status.cancelled {
            background-color: rgba(239, 68, 68, 0.1);
            color: var(--accent);
        }

        .action-buttons {
            display: flex;
            gap: 0.5rem;
        }

        .action-btn {
            padding: 0.4rem;
            border: none;
            border-radius: var(--radius);
            cursor: pointer;
            font-size: 0.8rem;
            transition: var(--transition);
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .action-btn.view {
            background-color: rgba(37, 99, 235, 0.1);
            color: var(--primary);
        }

        .action-btn.edit {
            background-color: rgba(16, 185, 129, 0.1);
            color: var(--success);
        }

        .action-btn.delete {
            background-color: rgba(239, 68, 68, 0.1);
            color: var(--accent);
        }

        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-sm);
        }

        /* Footer */
        .admin-footer {
            background-color: white;
            padding: 1.25rem 1.5rem;
            border-top: 1px solid var(--gray-200);
            color: var(--gray-500);
            font-size: 0.9rem;
            text-align: center;
        }

        /* Real-time Indicator */
        .real-time-indicator {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            font-size: 0.8rem;
            color: var(--success);
            margin-left: 10px;
            font-weight: 500;
        }

        .pulse {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--success);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.7); }
            70% { transform: scale(1); box-shadow: 0 0 0 10px rgba(16, 185, 129, 0); }
            100% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(16, 185, 129, 0); }
        }

        /* Refresh button */
        .refresh-btn {
            background: none;
            border: none;
            color: var(--gray-500);
            cursor: pointer;
            font-size: 1rem;
            transition: var(--transition);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .refresh-btn:hover {
            background-color: var(--gray-100);
            color: var(--primary);
            transform: rotate(180deg);
        }

        /* Animation */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes highlight {
            0% { background-color: rgba(37, 99, 235, 0.1); }
            100% { background-color: transparent; }
        }

        .fade-in {
            animation: fadeIn 0.5s ease;
        }

        /* User dropdown */
        .user-dropdown {
            position: absolute;
            top: 60px;
            right: 20px;
            background: white;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-lg);
            padding: 0.75rem 0;
            min-width: 220px;
            z-index: 1000;
            animation: fadeIn 0.3s ease;
            border: 1px solid var(--gray-200);
        }

        .user-dropdown a, .user-dropdown button {
            display: flex;
            align-items: center;
            gap: 10px;
            width: 100%;
            text-align: left;
            padding: 0.75rem 1.25rem;
            color: var(--gray-700);
            text-decoration: none;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 0.9rem;
            transition: var(--transition);
        }

        .user-dropdown a:hover, .user-dropdown button:hover {
            background-color: var(--gray-50);
            color: var(--primary);
        }

        .user-dropdown hr {
            margin: 0.5rem 0;
            border: none;
            border-top: 1px solid var(--gray-200);
        }

        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 10000;
            display: none;
            justify-content: center;
            align-items: center;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal-dialog {
            background: white;
            border-radius: var(--radius-lg);
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            box-shadow: var(--shadow-lg);
        }

        .modal-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--gray-200);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-body {
            padding: 1.5rem;
        }

        .modal-footer {
            padding: 1rem 1.5rem;
            border-top: 1px solid var(--gray-200);
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
        }

        .close-modal {
            position: absolute;
            top: 1rem;
            right: 1rem;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--gray-500);
            transition: color 0.3s;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .close-modal:hover {
            color: var(--accent);
            background-color: var(--gray-100);
        }

        /* Search Results */
        .search-results-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            width: 100%;
            background: white;
            border-radius: var(--radius);
            box-shadow: var(--shadow-lg);
            z-index: 1000;
            max-height: 300px;
            overflow-y: auto;
            display: none;
        }

        .search-result-item {
            padding: 1rem;
            border-bottom: 1px solid var(--gray-100);
            display: flex;
            align-items: center;
            gap: 1rem;
            cursor: pointer;
            transition: var(--transition);
        }

        .search-result-item:hover {
            background-color: var(--gray-50);
        }

        .search-result-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: var(--primary-light);
            color: var(--primary);
        }

        .search-result-content {
            flex: 1;
        }

        .search-result-title {
            font-weight: 600;
            color: var(--gray-800);
        }

        .search-result-subtitle {
            font-size: 0.8rem;
            color: var(--gray-500);
        }

        /* Responsive Styles */
        @media (max-width: 1200px) {
            .charts-container {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 992px) {
            .activity-container {
                grid-template-columns: 1fr;
            }
            
            .search-box input {
                width: 240px;
            }
        }

        @media (max-width: 768px) {
            .admin-sidebar {
                transform: translateX(-100%);
            }
            
            .admin-sidebar.active {
                transform: translateX(0);
            }
            
            .admin-main {
                margin-left: 0;
            }
            
            .admin-main.expanded {
                margin-left: 0;
            }
            
            .toggle-sidebar {
                display: flex;
            }
            
            .stats-grid {
                grid-template-columns: 1fr 1fr;
            }
            
            .search-box {
                display: none;
            }
        }

        @media (max-width: 576px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .admin-content {
                padding: 1rem;
            }
            
            .page-title {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.5rem;
            }
            
            .user-info {
                display: none;
            }
        }
    </style>
</head>
<body>
    <!-- Login Page -->
    <div id="login-page" class="login-container">
        <div class="login-card">
            <div class="login-header">
                <img src="https://www.pdsa.org.uk/media/12121/pdsa-logo.png" alt="PDSA Logo">
                <h1>Admin Dashboard</h1>
            </div>
            <div class="login-body">
                <div class="auth-tabs">
                    <button class="auth-tab active" data-tab="login">Login</button>
                    <button class="auth-tab" data-tab="register">Register</button>
                </div>

                <!-- Login Form -->
                <form id="login-form" class="auth-form active">
                    <div class="form-group">
                        <label for="email">Email</label>
                        <input type="email" id="email" placeholder="Enter your email" required>
                    </div>
                    <div class="form-group">
                        <label for="password">Password</label>
                        <input type="password" id="password" placeholder="Enter your password" required>
                    </div>
                    <button type="submit" class="btn btn-primary btn-block">
                        <i class="fas fa-sign-in-alt"></i> Sign In
                    </button>
                </form>

                <!-- Registration Form -->
                <form id="register-form" class="auth-form">
                    <div class="form-group">
                        <label for="reg-name">Full Name</label>
                        <input type="text" id="reg-name" placeholder="Enter your full name" required>
                    </div>
                    <div class="form-group">
                        <label for="reg-email">Email</label>
                        <input type="email" id="reg-email" placeholder="Enter your email" required>
                    </div>
                    <div class="form-group">
                        <label for="reg-password">Password</label>
                        <input type="password" id="reg-password" placeholder="Create a password (min. 6 characters)" required minlength="6">
                    </div>
                    <div class="form-group">
                        <label for="reg-confirm-password">Confirm Password</label>
                        <input type="password" id="reg-confirm-password" placeholder="Confirm your password" required>
                    </div>
                    <button type="submit" class="btn btn-primary btn-block">
                        <i class="fas fa-user-plus"></i> Create Account
                    </button>
                </form>
            </div>
            <div class="login-footer">
                <p>PDSA Veterinary Clinic Admin System</p>
            </div>
        </div>
    </div>

    <!-- Admin Dashboard -->
    <div id="admin-dashboard" class="admin-container" style="display: flex;">
        

        <!-- Main Content -->
        <main class="admin-main" id="admin-main">
            <!-- Header -->
            <header class="admin-header">
                <div class="header-left">
                    <button class="toggle-sidebar" id="toggle-sidebar">
                        <i class="fas fa-bars"></i>
                    </button>
                    <div class="search-box">
                        <i class="fas fa-search"></i>
                        <input type="text" placeholder="Search patients, appointments, orders..." id="global-search">
                    </div>
                </div>
                
                <div class="header-right">
                    <div class="header-action" id="notifications-btn">
                        <i class="far fa-bell"></i>
                        <span class="notification-badge" id="notification-count">5</span>
                    </div>
                    <div class="header-action" id="messages-btn">
                        <i class="far fa-envelope"></i>
                        <span class="notification-badge" id="message-count">3</span>
                    </div>
                    <div class="user-profile" id="user-profile">
                        <img src="https://images.unsplash.com/photo-1535713875002-d1d0cf377fde?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=100&q=80" alt="Admin User" id="user-avatar">
                        <div class="user-info">
                            <span class="user-name" id="user-name">Loading...</span>
                            <span class="user-role">Administrator</span>
                        </div>
                        <i class="fas fa-chevron-down"></i>
                    </div>
                </div>
            </header>

            <!-- Content -->
            <div class="admin-content">
                <!-- Dashboard Page -->
                <div id="dashboard-page" class="page-content active">
                    <div class="page-title">
                        <h1><i class="fas fa-tachometer-alt"></i> Dashboard 
                            <span class="real-time-indicator">
                                <span class="pulse"></span>
                                Live
                            </span>
                        </h1>
                        <div class="breadcrumb">
                            <a href="#">Dashboard</a>
                            <button class="refresh-btn" id="refresh-data" title="Refresh Data">
                                <i class="fas fa-sync-alt"></i>
                            </button>
                        </div>
                    </div>

                    <!-- Stats Grid -->
                    <div class="stats-grid" id="stats-grid">
                        <div class="stat-card">
                            <div class="stat-icon appointments">
                                <i class="fas fa-calendar-check"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="today-appointments">0</h3>
                                <p>Today's Appointments</p>
                            </div>
                            <div class="stat-trend trend-up">
                                <i class="fas fa-arrow-up"></i> <span id="appointments-trend">0%</span>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon revenue">
                                <i class="fas fa-money-bill-wave"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="monthly-revenue">R0</h3>
                                <p>Monthly Revenue</p>
                            </div>
                            <div class="stat-trend trend-up">
                                <i class="fas fa-arrow-up"></i> <span id="revenue-trend">0%</span>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon patients">
                                <i class="fas fa-paw"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="active-patients">0</h3>
                                <p>Active Patients</p>
                            </div>
                            <div class="stat-trend trend-up">
                                <i class="fas fa-arrow-up"></i> <span id="patients-trend">0%</span>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon products">
                                <i class="fas fa-shopping-bag"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="low-stock">0</h3>
                                <p>Low Stock Items</p>
                            </div>
                            <div class="stat-trend trend-down">
                                <i class="fas fa-arrow-down"></i> <span id="stock-trend">0%</span>
                            </div>
                        </div>
                    </div>

                    <!-- Charts and Graphs -->
                    <div class="charts-container">
                        <div class="chart-card">
                            <div class="chart-header">
                                <h3>Appointment Trends</h3>
                                <div class="chart-filter">
                                    <select id="chart-period">
                                        <option value="week">This Week</option>
                                        <option value="month" selected>This Month</option>
                                        <option value="quarter">This Quarter</option>
                                    </select>
                                </div>
                            </div>
                            <div class="chart-container">
                                <canvas id="appointments-chart"></canvas>
                            </div>
                        </div>
                        
                        <div class="chart-card">
                            <div class="chart-header">
                                <h3>Service Distribution</h3>
                                <div class="chart-filter">
                                    <select id="service-category">
                                        <option value="all" selected>All Services</option>
                                        <option value="medical">Medical</option>
                                        <option value="surgical">Surgical</option>
                                    </select>
                                </div>
                            </div>
                            <div class="chart-container">
                                <canvas id="services-chart"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- Recent Activity -->
                    <div class="activity-container">
                        <div class="activity-card">
                            <div class="activity-header">
                                <h3>Recent Appointments</h3>
                                <a href="#" class="view-all">View All</a>
                            </div>
                            <ul class="activity-list" id="recent-appointments">
                                <!-- Dynamic content will be loaded here -->
                            </ul>
                        </div>
                        
                        <div class="activity-card">
                            <div class="activity-header">
                                <h3>Recent Payments</h3>
                                <a href="#" class="view-all">View All</a>
                            </div>
                            <ul class="activity-list" id="recent-payments">
                                <!-- Dynamic content will be loaded here -->
                            </ul>
                        </div>
                    </div>

                    <!-- Upcoming Appointments Table -->
                    <div class="table-card">
                        <div class="table-header">
                            <h3>Upcoming Appointments</h3>
                            <button class="btn btn-primary" id="add-appointment">
                                <i class="fas fa-plus"></i> Add Appointment
                            </button>
                        </div>
                        <table>
                            <thead>
                                <tr>
                                    <th>Patient</th>
                                    <th>Service</th>
                                    <th>Date & Time</th>
                                    <th>Veterinarian</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="appointments-table-body">
                                <!-- Dynamic content will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Products Management Page -->
                <div id="products-page" class="page-content">
                    <div class="page-title">
                        <h1><i class="fas fa-shopping-cart"></i> Products Management</h1>
                        <div class="breadcrumb">
                            <a href="#">Dashboard</a> / <span>Products</span>
                        </div>
                    </div>

                    <div class="table-card">
                        <div class="table-header">
                            <h3>All Products</h3>
                            <button class="btn btn-primary" id="add-product">
                                <i class="fas fa-plus"></i> Add Product
                            </button>
                        </div>
                        <table>
                            <thead>
                                <tr>
                                    <th>Image</th>
                                    <th>Name</th>
                                    <th>Category</th>
                                    <th>Price</th>
                                    <th>Stock</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="products-table-body">
                                <!-- Dynamic content will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Appointments Management Page -->
                <div id="appointments-page" class="page-content">
                    <div class="page-title">
                        <h1><i class="fas fa-calendar-alt"></i> Appointments Management</h1>
                        <div class="breadcrumb">
                            <a href="#">Dashboard</a> / <span>Appointments</span>
                        </div>
                    </div>

                    <div class="table-card">
                        <div class="table-header">
                            <h3>All Appointments</h3>
                            <button class="btn btn-primary" id="add-appointment-page">
                                <i class="fas fa-plus"></i> Add Appointment
                            </button>
                        </div>
                        <table>
                            <thead>
                                <tr>
                                    <th>Patient</th>
                                    <th>Service</th>
                                    <th>Date & Time</th>
                                    <th>Veterinarian</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="all-appointments-table-body">
                                <!-- Dynamic content will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Other pages would go here -->
            </div>

            <!-- Footer -->
            <footer class="admin-footer">
                <p>&copy; 2024 PDSA Veterinary Clinic Admin Dashboard. All rights reserved.</p>
            </footer>
        </main>
    </div>

    <!-- Toast Notification Container -->
    <div id="toast-container"></div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyB6QmZtUg2qajsUfeii7MBkDmGEbm5JkOE",
            authDomain: "pdsa-database.firebaseapp.com",
            databaseURL: "https://pdsa-database-default-rtdb.firebaseio.com",
            projectId: "pdsa-database",
            storageBucket: "pdsa-database.firebasestorage.app",
            messagingSenderId: "1041468794677",
            appId: "1:1041468794677:web:e7d38f76c644173cf48e7c",
            measurementId: "G-8QLD9BK9M0"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        const storage = firebase.storage();

        document.addEventListener('DOMContentLoaded', function() {
            initializeFirebaseAuth();
            setupEventListeners();
        });

        // ==================== FIREBASE AUTHENTICATION ====================

        function initializeFirebaseAuth() {
            auth.onAuthStateChanged((user) => {
                if (user) {
                    // Admin is signed in
                    console.log('User signed in:', user);
                    
                    // Update UI with user info
                    document.getElementById('user-name').textContent = user.displayName || user.email;
                    document.getElementById('user-avatar').src = user.photoURL || 'https://images.unsplash.com/photo-1535713875002-d1d0cf377fde?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=100&q=80';
                    
                    // Show dashboard and hide login
                    document.getElementById('login-page').style.display = 'none';
                    document.getElementById('admin-dashboard').style.display = 'flex';
                    
                    showToast(`Welcome back, ${user.displayName || user.email}!`, 'success');
                    
                    // Initialize dashboard data
                    initializeDashboardData();
                    
                } else {
                    // Admin is signed out, show login
                    document.getElementById('login-page').style.display = 'flex';
                    document.getElementById('admin-dashboard').style.display = 'none';
                }
            });
        }

        // ==================== EVENT LISTENERS ====================

        function setupEventListeners() {
            // Tab switching
            document.querySelectorAll('.auth-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const targetTab = this.getAttribute('data-tab');
                    
                    // Update active tab
                    document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Show corresponding form
                    document.querySelectorAll('.auth-form').forEach(form => {
                        form.classList.remove('active');
                    });
                    document.getElementById(`${targetTab}-form`).classList.add('active');
                });
            });

            // Login form submission
            document.getElementById('login-form').addEventListener('submit', function(e) {
                e.preventDefault();
                const email = document.getElementById('email').value;
                const password = document.getElementById('password').value;
                
                loginUser(email, password);
            });

            // Registration form submission
            document.getElementById('register-form').addEventListener('submit', function(e) {
                e.preventDefault();
                const name = document.getElementById('reg-name').value;
                const email = document.getElementById('reg-email').value;
                const password = document.getElementById('reg-password').value;
                const confirmPassword = document.getElementById('reg-confirm-password').value;
                
                if (password !== confirmPassword) {
                    showToast('Passwords do not match', 'error');
                    return;
                }
                
                if (password.length < 6) {
                    showToast('Password must be at least 6 characters', 'error');
                    return;
                }
                
                registerUser(name, email, password);
            });

            // Dashboard event listeners
            document.getElementById('toggle-sidebar').addEventListener('click', function() {
                document.getElementById('admin-sidebar').classList.toggle('collapsed');
                document.getElementById('admin-main').classList.toggle('expanded');
            });

            document.getElementById('user-profile').addEventListener('click', showUserMenu);

            // Navigation
            document.querySelectorAll('.menu-item').forEach(item => {
                item.addEventListener('click', function(e) {
                    e.preventDefault();
                    const page = this.getAttribute('data-page');
                    navigateToPage(page);
                });
            });

            // Refresh data button
            document.getElementById('refresh-data').addEventListener('click', function() {
                refreshDashboardData();
            });

            // Add appointment button
            document.getElementById('add-appointment').addEventListener('click', function() {
                showAddAppointmentModal();
            });

            // Add product button
            document.getElementById('add-product').addEventListener('click', function() {
                showAddProductModal();
            });

            // Add appointment button on appointments page
            document.getElementById('add-appointment-page').addEventListener('click', function() {
                showAddAppointmentModal();
            });

            // Search functionality
            document.getElementById('global-search').addEventListener('input', function(e) {
                performGlobalSearch(e.target.value);
            });
        }

        // ==================== AUTH FUNCTIONS ====================

        async function loginUser(email, password) {
            const submitBtn = document.querySelector('#login-form button[type="submit"]');
            const originalText = submitBtn.innerHTML;
            
            // Show loading state
            submitBtn.innerHTML = '<div class="loading"></div> Signing In...';
            submitBtn.disabled = true;
            
            try {
                const userCredential = await auth.signInWithEmailAndPassword(email, password);
                console.log('Login successful:', userCredential.user);
            } catch (error) {
                console.error('Login error:', error);
                
                let errorMessage = 'Login failed. Please try again.';
                
                switch (error.code) {
                    case 'auth/invalid-email':
                        errorMessage = 'Invalid email address.';
                        break;
                    case 'auth/user-disabled':
                        errorMessage = 'This account has been disabled.';
                        break;
                    case 'auth/user-not-found':
                        errorMessage = 'No account found with this email.';
                        break;
                    case 'auth/wrong-password':
                        errorMessage = 'Incorrect password.';
                        break;
                    case 'auth/too-many-requests':
                        errorMessage = 'Too many failed attempts. Please try again later.';
                        break;
                }
                
                showToast(errorMessage, 'error');
                
                // Reset button
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
            }
        }

        async function registerUser(name, email, password) {
            const submitBtn = document.querySelector('#register-form button[type="submit"]');
            const originalText = submitBtn.innerHTML;
            
            // Show loading state
            submitBtn.innerHTML = '<div class="loading"></div> Creating Account...';
            submitBtn.disabled = true;
            
            try {
                const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                
                // Update user profile
                await userCredential.user.updateProfile({
                    displayName: name
                });
                
                // Create user document in Firestore
                await db.collection('users').doc(userCredential.user.uid).set({
                    name: name,
                    email: email,
                    role: 'admin',
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                console.log('Registration successful:', userCredential.user);
                showToast('Account created successfully!', 'success');
                
            } catch (error) {
                console.error('Registration error:', error);
                
                let errorMessage = 'Registration failed. Please try again.';
                
                switch (error.code) {
                    case 'auth/email-already-in-use':
                        errorMessage = 'An account with this email already exists.';
                        break;
                    case 'auth/invalid-email':
                        errorMessage = 'Invalid email address.';
                        break;
                    case 'auth/weak-password':
                        errorMessage = 'Password is too weak. Please use a stronger password.';
                        break;
                    case 'auth/operation-not-allowed':
                        errorMessage = 'Email/password accounts are not enabled.';
                        break;
                }
                
                showToast(errorMessage, 'error');
                
                // Reset button
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
            }
        }

        // ==================== DASHBOARD FUNCTIONS ====================

        function navigateToPage(page) {
            // Update active menu item
            document.querySelectorAll('.menu-item').forEach(item => {
                item.classList.remove('active');
            });
            document.querySelector(`[data-page="${page}"]`).classList.add('active');

            // Hide all pages
            document.querySelectorAll('.page-content').forEach(content => {
                content.classList.remove('active');
            });

            // Show selected page
            document.getElementById(`${page}-page`).classList.add('active');

            // Load page-specific data
            if (page === 'products') {
                loadProductsData();
            } else if (page === 'appointments') {
                loadAllAppointmentsData();
            } else if (page === 'dashboard') {
                loadDashboardData();
            }
        }

        function showUserMenu() {
            // Remove existing dropdown if any
            const existingDropdown = document.querySelector('.user-dropdown');
            if (existingDropdown) {
                existingDropdown.remove();
                return;
            }

            // Create dropdown menu
            const dropdown = document.createElement('div');
            dropdown.className = 'user-dropdown';
            
            dropdown.innerHTML = `
                <a href="#"><i class="fas fa-user"></i> My Profile</a>
                <a href="#"><i class="fas fa-cog"></i> Account Settings</a>
                <a href="#"><i class="fas fa-bell"></i> Notification Preferences</a>
                <hr>
                <button id="logout-btn"><i class="fas fa-sign-out-alt"></i> Logout</button>
            `;
            
            document.body.appendChild(dropdown);
            
            // Add logout functionality
            document.getElementById('logout-btn').addEventListener('click', async function() {
                showToast('Logging out...', 'info');
                try {
                    await auth.signOut();
                } catch (error) {
                    console.error('Logout error:', error);
                    showToast('Error logging out', 'error');
                }
            });
            
            // Close dropdown when clicking outside
            document.addEventListener('click', function closeDropdown(e) {
                if (!dropdown.contains(e.target) && e.target !== document.getElementById('user-profile')) {
                    dropdown.remove();
                    document.removeEventListener('click', closeDropdown);
                }
            });
        }

        function initializeDashboardData() {
            // Initialize charts
            initializeCharts();
            
            // Load data from Firebase
            loadDashboardData();
            
            // Set up real-time listeners
            setupRealtimeListeners();
        }

        function refreshDashboardData() {
            const refreshBtn = document.getElementById('refresh-data');
            refreshBtn.style.transform = 'rotate(360deg)';
            
            // Reload data
            loadDashboardData();
            
            setTimeout(() => {
                refreshBtn.style.transform = 'rotate(0deg)';
                showToast('Dashboard data refreshed!', 'success');
            }, 500);
        }

        function loadDashboardData() {
            // Load appointments data
            const today = new Date().toISOString().split('T')[0];
            
            db.collection('appointments').where('date', '>=', today)
                .orderBy('date')
                .limit(10)
                .get()
                .then((querySnapshot) => {
                    const appointmentsTable = document.getElementById('appointments-table-body');
                    const recentAppointments = document.getElementById('recent-appointments');
                    
                    appointmentsTable.innerHTML = '';
                    recentAppointments.innerHTML = '';
                    
                    if (querySnapshot.empty) {
                        appointmentsTable.innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 2rem;">No upcoming appointments</td></tr>';
                        recentAppointments.innerHTML = '<li class="activity-item"><div class="activity-content"><p>No recent appointments</p></div></li>';
                    } else {
                        querySnapshot.forEach((doc) => {
                            const appointment = doc.data();
                            const row = document.createElement('tr');
                            
                            row.innerHTML = `
                                <td>${appointment.patientName || 'N/A'} (${appointment.petType || 'N/A'})</td>
                                <td>${appointment.service || 'N/A'}</td>
                                <td>${formatDate(appointment.date)} ${appointment.time || ''}</td>
                                <td>${appointment.veterinarian || 'N/A'}</td>
                                <td><span class="status ${appointment.status || 'pending'}">${appointment.status || 'Pending'}</span></td>
                                <td>
                                    <div class="action-buttons">
                                        <button class="action-btn view" data-id="${doc.id}">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                        <button class="action-btn edit" data-id="${doc.id}">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                    </div>
                                </td>
                            `;
                            
                            appointmentsTable.appendChild(row);
                            
                            // Add to recent activity
                            if (querySnapshot.docs.indexOf(doc) < 3) {
                                const activityItem = document.createElement('li');
                                activityItem.className = 'activity-item';
                                activityItem.innerHTML = `
                                    <div class="activity-icon appointment">
                                        <i class="fas fa-calendar-check"></i>
                                    </div>
                                    <div class="activity-content">
                                        <p><strong>${appointment.patientName}</strong> - ${appointment.service}</p>
                                        <p class="time">${formatDate(appointment.date)} ${appointment.time} | ${appointment.veterinarian}</p>
                                    </div>
                                `;
                                recentAppointments.appendChild(activityItem);
                            }
                        });
                    }
                })
                .catch((error) => {
                    console.error('Error loading appointments:', error);
                    showToast('Error loading appointments', 'error');
                });
            
            // Load stats data
            loadStatsData();
        }

        function loadStatsData() {
            // Today's appointments count
            const today = new Date().toISOString().split('T')[0];
            db.collection('appointments').where('date', '==', today)
                .get()
                .then((querySnapshot) => {
                    document.getElementById('today-appointments').textContent = querySnapshot.size;
                })
                .catch((error) => {
                    console.error('Error loading today appointments:', error);
                });
            
            // Active patients count
            db.collection('patients').where('status', '==', 'active')
                .get()
                .then((querySnapshot) => {
                    document.getElementById('active-patients').textContent = querySnapshot.size;
                })
                .catch((error) => {
                    console.error('Error loading patients:', error);
                });
            
            // Monthly revenue
            const currentMonth = new Date().getMonth() + 1;
            const currentYear = new Date().getFullYear();
            
            db.collection('payments')
                .where('month', '==', currentMonth)
                .where('year', '==', currentYear)
                .get()
                .then((querySnapshot) => {
                    let totalRevenue = 0;
                    querySnapshot.forEach((doc) => {
                        totalRevenue += parseFloat(doc.data().amount || 0);
                    });
                    document.getElementById('monthly-revenue').textContent = `R${totalRevenue.toLocaleString()}`;
                    
                    // Add recent payments to activity
                    const recentPayments = document.getElementById('recent-payments');
                    recentPayments.innerHTML = '';
                    
                    querySnapshot.forEach((doc, index) => {
                        if (index < 3) {
                            const payment = doc.data();
                            const activityItem = document.createElement('li');
                            activityItem.className = 'activity-item';
                            activityItem.innerHTML = `
                                <div class="activity-icon payment">
                                    <i class="fas fa-credit-card"></i>
                                </div>
                                <div class="activity-content">
                                    <p><strong>${payment.customerName || 'Customer'}</strong> - R${payment.amount}</p>
                                    <p class="time">${formatDate(payment.date)} | ${payment.status || 'Completed'}</p>
                                </div>
                            `;
                            recentPayments.appendChild(activityItem);
                        }
                    });
                })
                .catch((error) => {
                    console.error('Error loading payments:', error);
                });
            
            // Low stock items
            db.collection('products').where('stock', '<=', 10)
                .get()
                .then((querySnapshot) => {
                    document.getElementById('low-stock').textContent = querySnapshot.size;
                })
                .catch((error) => {
                    console.error('Error loading low stock items:', error);
                });
        }

        function setupRealtimeListeners() {
            // Real-time appointments listener
            db.collection('appointments')
                .where('date', '>=', new Date().toISOString().split('T')[0])
                .orderBy('date')
                .limit(10)
                .onSnapshot((querySnapshot) => {
                    loadDashboardData(); // Reload data when appointments change
                });
        }

        // ==================== PRODUCTS MANAGEMENT ====================

        function loadProductsData() {
            db.collection('products').orderBy('name').get()
                .then((querySnapshot) => {
                    const productsTable = document.getElementById('products-table-body');
                    productsTable.innerHTML = '';
                    
                    if (querySnapshot.empty) {
                        productsTable.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 2rem;">No products found</td></tr>';
                    } else {
                        querySnapshot.forEach((doc) => {
                            const product = doc.data();
                            const row = document.createElement('tr');
                            
                           row.innerHTML = `
  <td>
    ${product.imageUrl ? 
      `<img src="${product.imageUrl}" alt="${product.name}" style="width: 50px; height: 50px; object-fit: cover; border-radius: 4px;">` : 
      '<div style="width: 50px; height: 50px; background: #f1f5f9; display: flex; align-items: center; justify-content: center; border-radius: 4px;"><i class="fas fa-image" style="color: #94a3b8;"></i></div>'
    }
  </td>

                                <td>${product.name}</td>
                                <td>${product.category || 'Uncategorized'}</td>
                                <td>R${product.price || '0'}</td>
                                <td>${product.stock || '0'}</td>
                                <td><span class="status ${(product.stock || 0) > 0 ? 'confirmed' : 'cancelled'}">${(product.stock || 0) > 0 ? 'In Stock' : 'Out of Stock'}</span></td>
                                <td>
                                    <div class="action-buttons">
                                        <button class="action-btn edit" data-id="${doc.id}">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="action-btn delete" data-id="${doc.id}">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                </td>
                            `;
                            
                            productsTable.appendChild(row);
                        });
                    }
                })
                .catch((error) => {
                    console.error('Error loading products:', error);
                    showToast('Error loading products', 'error');
                });
        }

        function showAddProductModal() {
            const modalHTML = `
                <div class="modal-overlay active" id="product-modal">
                    <div class="modal-dialog">
                        <div class="modal-header">
                            <h3>Add New Product</h3>
                            <button class="close-modal" id="close-product-modal">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div class="modal-body">
                            <form id="new-product-form">
                                <div class="form-group">
                                    <label for="product-name">Product Name</label>
                                    <input type="text" id="product-name" placeholder="Enter product name" required>
                                </div>
                                <div class="form-group">
                                    <label for="product-description">Description</label>
                                    <textarea id="product-description" placeholder="Enter product description" rows="3"></textarea>
                                </div>
                                <div class="form-group">
                                    <label for="product-category">Category</label>
                                    <select id="product-category" required>
                                        <option value="">Select category</option>
                                        <option value="food">Pet Food</option>
                                        <option value="toys">Toys</option>
                                        <option value="health">Health & Wellness</option>
                                        <option value="grooming">Grooming</option>
                                        <option value="medication">Medication</option>
                                        <option value="other">Other</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="product-price">Price (R)</label>
                                    <input type="number" id="product-price" placeholder="Enter price" step="0.01" min="0" required>
                                </div>
                                <div class="form-group">
                                    <label for="product-stock">Stock Quantity</label>
                                    <input type="number" id="product-stock" placeholder="Enter stock quantity" min="0" required>
                                </div>
                                <div class="form-group">
                                    <label for="product-image">Product Image</label>
                                    <input type="file" id="product-image" accept="image/*">
                                </div>
                            </form>
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-secondary" id="cancel-product">Cancel</button>
                            <button class="btn btn-primary" id="save-product">Save Product</button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modalHTML);
            
            // Event listeners for modal
            document.getElementById('close-product-modal').addEventListener('click', closeProductModal);
            document.getElementById('cancel-product').addEventListener('click', closeProductModal);
            document.getElementById('save-product').addEventListener('click', saveProduct);
        }

        function closeProductModal() {
            const modal = document.getElementById('product-modal');
            if (modal) {
                modal.remove();
            }
        }

        async function saveProduct() {
            const name = document.getElementById('product-name').value;
            const description = document.getElementById('product-description').value;
            const category = document.getElementById('product-category').value;
            const price = parseFloat(document.getElementById('product-price').value);
            const stock = parseInt(document.getElementById('product-stock').value);
            const imageFile = document.getElementById('product-image').files[0];
            
            if (!name || !category || isNaN(price) || isNaN(stock)) {
                showToast('Please fill all required fields', 'error');
                return;
            }
            
            const productData = {
                name: name,
                description: description,
                category: category,
                price: price,
                stock: stock,
                createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                updatedAt: firebase.firestore.FieldValue.serverTimestamp()
            };
            
            try {
                // If there's an image, upload it first
                if (imageFile) {
                    const storageRef = storage.ref(`products/${Date.now()}_${imageFile.name}`);
                    const uploadTask = await storageRef.put(imageFile);
                    const imageUrl = await uploadTask.ref.getDownloadURL();
                    productData.imageUrl = imageUrl;
                }
                
                // Save product to Firestore
                await db.collection('products').add(productData);
                
                showToast('Product added successfully!', 'success');
                closeProductModal();
                loadProductsData(); // Refresh the products list
                
            } catch (error) {
                console.error('Error adding product:', error);
                showToast('Error adding product. Please try again.', 'error');
            }
        }

        // ==================== APPOINTMENT MANAGEMENT ====================

        function loadAllAppointmentsData() {
            db.collection('appointments').orderBy('date', 'desc').get()
                .then((querySnapshot) => {
                    const appointmentsTable = document.getElementById('all-appointments-table-body');
                    appointmentsTable.innerHTML = '';
                    
                    if (querySnapshot.empty) {
                        appointmentsTable.innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 2rem;">No appointments found</td></tr>';
                    } else {
                        querySnapshot.forEach((doc) => {
                            const appointment = doc.data();
                            const row = document.createElement('tr');
                            
                            row.innerHTML = `
                                <td>${appointment.patientName || 'N/A'} (${appointment.petType || 'N/A'})</td>
                                <td>${appointment.service || 'N/A'}</td>
                                <td>${formatDate(appointment.date)} ${appointment.time || ''}</td>
                                <td>${appointment.veterinarian || 'N/A'}</td>
                                <td><span class="status ${appointment.status || 'pending'}">${appointment.status || 'Pending'}</span></td>
                                <td>
                                    <div class="action-buttons">
                                        <button class="action-btn view" data-id="${doc.id}">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                        <button class="action-btn edit" data-id="${doc.id}">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="action-btn delete" data-id="${doc.id}">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                </td>
                            `;
                            
                            appointmentsTable.appendChild(row);
                        });
                    }
                })
                .catch((error) => {
                    console.error('Error loading appointments:', error);
                    showToast('Error loading appointments', 'error');
                });
        }

        function showAddAppointmentModal() {
            const modalHTML = `
                <div class="modal-overlay active" id="appointment-modal">
                    <div class="modal-dialog">
                        <div class="modal-header">
                            <h3>Add New Appointment</h3>
                            <button class="close-modal" id="close-appointment-modal">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div class="modal-body">
                            <form id="new-appointment-form">
                                <div class="form-group">
                                    <label for="patient-name">Patient Name</label>
                                    <input type="text" id="patient-name" placeholder="Enter patient name" required>
                                </div>
                                <div class="form-group">
                                    <label for="pet-type">Pet Type</label>
                                    <select id="pet-type" required>
                                        <option value="">Select pet type</option>
                                        <option value="Dog">Dog</option>
                                        <option value="Cat">Cat</option>
                                        <option value="Bird">Bird</option>
                                        <option value="Other">Other</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="service">Service</label>
                                    <select id="service" required>
                                        <option value="">Select service</option>
                                        <option value="Checkup">Checkup</option>
                                        <option value="Vaccination">Vaccination</option>
                                        <option value="Dental">Dental Care</option>
                                        <option value="Surgery">Surgery</option>
                                        <option value="Emergency">Emergency</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="appointment-date">Date</label>
                                    <input type="date" id="appointment-date" required>
                                </div>
                                <div class="form-group">
                                    <label for="appointment-time">Time</label>
                                    <input type="time" id="appointment-time" required>
                                </div>
                                <div class="form-group">
                                    <label for="veterinarian">Veterinarian</label>
                                    <select id="veterinarian" required>
                                        <option value="">Select veterinarian</option>
                                        <option value="Dr. Sarah Johnson">Dr. Sarah Johnson</option>
                                        <option value="Dr. Michael Brown">Dr. Michael Brown</option>
                                        <option value="Dr. Emily Davis">Dr. Emily Davis</option>
                                    </select>
                                </div>
                            </form>
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-secondary" id="cancel-appointment">Cancel</button>
                            <button class="btn btn-primary" id="save-appointment">Save Appointment</button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modalHTML);
            
            // Set minimum date to today
            document.getElementById('appointment-date').min = new Date().toISOString().split('T')[0];
            
            // Event listeners for modal
            document.getElementById('close-appointment-modal').addEventListener('click', closeAppointmentModal);
            document.getElementById('cancel-appointment').addEventListener('click', closeAppointmentModal);
            document.getElementById('save-appointment').addEventListener('click', saveAppointment);
        }

        function closeAppointmentModal() {
            const modal = document.getElementById('appointment-modal');
            if (modal) {
                modal.remove();
            }
        }

        function saveAppointment() {
            const form = document.getElementById('new-appointment-form');
            
            const appointmentData = {
                patientName: document.getElementById('patient-name').value,
                petType: document.getElementById('pet-type').value,
                service: document.getElementById('service').value,
                date: document.getElementById('appointment-date').value,
                time: document.getElementById('appointment-time').value,
                veterinarian: document.getElementById('veterinarian').value,
                status: 'confirmed',
                createdAt: firebase.firestore.FieldValue.serverTimestamp()
            };
            
            // Save to Firebase
            db.collection('appointments').add(appointmentData)
                .then(() => {
                    showToast('Appointment added successfully!', 'success');
                    closeAppointmentModal();
                    loadDashboardData(); // Refresh dashboard
                    if (document.getElementById('appointments-page').classList.contains('active')) {
                        loadAllAppointmentsData(); // Refresh appointments page
                    }
                })
                .catch((error) => {
                    console.error('Error adding appointment:', error);
                    showToast('Error adding appointment. Please try again.', 'error');
                });
        }

        // ==================== SEARCH FUNCTIONALITY ====================

        function performGlobalSearch(query) {
            if (query.length < 2) return; // Don't search for very short queries
            
            const searchResults = [];
            
            // Search appointments
            db.collection('appointments').where('patientName', '>=', query)
                .where('patientName', '<=', query + '\uf8ff')
                .limit(5)
                .get()
                .then((querySnapshot) => {
                    querySnapshot.forEach((doc) => {
                        searchResults.push({
                            type: 'Appointment',
                            data: doc.data(),
                            id: doc.id
                        });
                    });
                    
                    // Search products
                    return db.collection('products').where('name', '>=', query)
                        .where('name', '<=', query + '\uf8ff')
                        .limit(5)
                        .get();
                })
                .then((querySnapshot) => {
                    querySnapshot.forEach((doc) => {
                        searchResults.push({
                            type: 'Product',
                            data: doc.data(),
                            id: doc.id
                        });
                    });
                    
                    // Display search results
                    displaySearchResults(searchResults);
                })
                .catch((error) => {
                    console.error('Error performing search:', error);
                });
        }

        function displaySearchResults(results) {
            // Create or update search results dropdown
            let searchDropdown = document.getElementById('search-results-dropdown');
            
            if (!searchDropdown) {
                searchDropdown = document.createElement('div');
                searchDropdown.id = 'search-results-dropdown';
                searchDropdown.className = 'search-results-dropdown';
                document.querySelector('.search-box').appendChild(searchDropdown);
            }
            
            if (results.length === 0) {
                searchDropdown.innerHTML = '<div class="search-result-item">No results found</div>';
            } else {
                searchDropdown.innerHTML = '';
                results.forEach(result => {
                    const resultItem = document.createElement('div');
                    resultItem.className = 'search-result-item';
                    
                    let content = '';
                    if (result.type === 'Appointment') {
                        content = `
                            <div class="search-result-icon">
                                <i class="fas fa-calendar-alt"></i>
                            </div>
                            <div class="search-result-content">
                                <div class="search-result-title">${result.data.patientName}</div>
                                <div class="search-result-subtitle">${result.data.service} - ${formatDate(result.data.date)}</div>
                            </div>
                        `;
                    } else if (result.type === 'Product') {
                        content = `
                            <div class="search-result-icon">
                                <i class="fas fa-shopping-bag"></i>
                            </div>
                            <div class="search-result-content">
                                <div class="search-result-title">${result.data.name}</div>
                                <div class="search-result-subtitle">R${result.data.price} - ${result.data.category}</div>
                            </div>
                        `;
                    }
                    
                    resultItem.innerHTML = content;
                    searchDropdown.appendChild(resultItem);
                });
            }
            
            searchDropdown.style.display = 'block';
        }

        // ==================== UTILITY FUNCTIONS ====================

        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : type === 'warning' ? 'exclamation-triangle' : 'info-circle'}"></i>
                <span>${message}</span>
            `;
            document.getElementById('toast-container').appendChild(toast);
            
            setTimeout(() => toast.classList.add('show'), 100);
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => toast.remove(), 300);
            }, 5000);
        }

        function formatDate(dateString) {
            if (!dateString) return 'N/A';
            const options = { weekday: 'short', month: 'short', day: 'numeric' };
            return new Date(dateString).toLocaleDateString('en-US', options);
        }

        function initializeCharts() {
            // Appointments Chart
            const appointmentsCtx = document.getElementById('appointments-chart');
            if (appointmentsCtx) {
                new Chart(appointmentsCtx, {
                    type: 'line',
                    data: {
                        labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                        datasets: [{
                            label: 'Appointments',
                            data: [12, 19, 15, 17, 24, 18, 10],
                            borderColor: '#2563eb',
                            backgroundColor: 'rgba(37, 99, 235, 0.1)',
                            borderWidth: 2,
                            tension: 0.4,
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            }
                        }
                    }
                });
            }

            // Services Chart
            const servicesCtx = document.getElementById('services-chart');
            if (servicesCtx) {
                new Chart(servicesCtx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Checkups', 'Vaccinations', 'Dental', 'Surgery', 'Emergency'],
                        datasets: [{
                            data: [35, 25, 15, 10, 15],
                            backgroundColor: [
                                '#2563eb',
                                '#10b981',
                                '#f59e0b',
                                '#ef4444',
                                '#8b5cf6'
                            ],
                            borderWidth: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        cutout: '70%',
                        plugins: {
                            legend: {
                                position: 'bottom'
                            }
                        }
                    }
                });
            }
        }
    </script>
</body>
</html>