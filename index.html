<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDSA Veterinary Clinic - Soweto</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-storage.js"></script>
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --accent: #e74c3c;
            --light: #ecf0f1;
            --dark: #2c3e50;
            --success: #2ecc71;
            --warning: #f39c12;
            --danger: #e74c3c;
            --info: #17a2b8;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
            overflow-x: hidden;
        }
        
        /* Header Styles */
        header {
            background-color: var(--primary);
            color: white;
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .logo img {
            height: 50px;
        }
        
        .logo h1 {
            font-size: 1.5rem;
        }
        
        nav {
            display: flex;
            align-items: center;
        }

        nav ul {
            display: flex;
            list-style: none;
            gap: 5px;
            margin: 0;
            padding: 0;
        }

        nav li {
            position: relative;
        }
        
        nav a {
            color: white;
            text-decoration: none;
            font-weight: 500;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            transition: all 0.3s;
            position: relative;
        }
        
        nav a:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }
        
        nav a.active {
            background-color: var(--secondary);
        }
        
        nav a.active::after {
            content: '';
            position: absolute;
            bottom: -8px;
            left: 50%;
            transform: translateX(-50%);
            width: 6px;
            height: 6px;
            background-color: var(--secondary);
            border-radius: 50%;
        }
        
        .auth-buttons {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .admin-link {
            color: white;
            text-decoration: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
            background-color: rgba(255, 255, 255, 0.1);
        }

        .admin-link:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }
        
        .cart-icon {
            position: relative;
            color: white;
            background-color: rgba(255, 255, 255, 0.1);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .cart-icon:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }
        
        .cart-count {
            position: absolute;
            top: -5px;
            right: -5px;
            background-color: var(--danger);
            color: white;
            font-size: 0.7rem;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
        }
        
        .btn-primary {
            background-color: var(--secondary);
            color: white;
        }
        
        .btn-outline {
            background-color: transparent;
            border: 1px solid white;
            color: white;
        }
        
        .btn-success {
            background-color: var(--success);
            color: white;
        }
        
        .btn-warning {
            background-color: var(--warning);
            color: white;
        }
        
        .btn-danger {
            background-color: var(--danger);
            color: white;
        }
        
        .btn-info {
            background-color: var(--info);
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #2980b9;
            transform: translateY(-2px);
        }
        
        .btn-outline:hover {
            background-color: rgba(255, 255, 255, 0.1);
            transform: translateY(-2px);
        }
        
        /* Hero Section */
        .hero {
            background: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), url('https://images.unsplash.com/photo-1583337130417-3346a1be7dee?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1964&q=80');
            background-size: cover;
            background-position: center;
            min-height: 70vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            color: white;
            padding: 2rem;
            position: relative;
        }
        
        .hero h2 {
            font-size: clamp(1.8rem, 4vw, 2.5rem);
            margin-bottom: 1rem;
            animation: fadeInDown 1s ease;
        }
        
        .hero p {
            font-size: clamp(1rem, 2vw, 1.2rem);
            margin-bottom: 2rem;
            max-width: 700px;
            animation: fadeInUp 1s ease;
        }
        
        .hero-buttons {
            display: flex;
            gap: 15px;
            animation: fadeIn 1.5s ease;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .emergency-banner {
            position: absolute;
            top: 20px;
            right: 20px;
            background-color: var(--danger);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            display: flex;
            align-items: center;
            gap: 8px;
            animation: pulse 2s infinite;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
        }
        
        .emergency-banner:hover {
            background-color: #c0392b;
            transform: scale(1.05);
        }
        
        /* Services Section */
        .services {
            padding: 4rem 2rem;
            background-color: white;
        }
        
        .section-title {
            text-align: center;
            margin-bottom: 3rem;
        }
        
        .section-title h2 {
            font-size: clamp(1.5rem, 3vw, 2rem);
            color: var(--primary);
            margin-bottom: 1rem;
            position: relative;
            display: inline-block;
        }
        
        .section-title h2::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 80px;
            height: 3px;
            background-color: var(--secondary);
        }
        
        .section-title p {
            max-width: 700px;
            margin: 0 auto;
            color: #666;
        }
        
        .services-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
        }
        
        .service-card {
            background-color: var(--light);
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: all 0.3s;
            border: 1px solid #eee;
        }
        
        .service-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }
        
        .service-img {
            height: 200px;
            overflow: hidden;
        }
        
        .service-img img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s ease;
        }
        
        .service-card:hover .service-img img {
            transform: scale(1.05);
        }
        
        .service-content {
            padding: 1.5rem;
        }
        
        .service-content h3 {
            margin-bottom: 0.5rem;
            color: var(--primary);
        }
        
        .service-content .price {
            color: var(--secondary);
            font-weight: bold;
            margin-bottom: 0.5rem;
        }
        
        .service-content p {
            margin-bottom: 1rem;
            color: #666;
        }
        
        .service-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 1rem;
            font-size: 0.9rem;
            color: #666;
        }
        
        /* Products Section */
        .products {
            padding: 4rem 2rem;
            background-color: var(--light);
        }
        
        .product-filters {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }
        
        .filter-btn {
            padding: 0.5rem 1rem;
            border: 1px solid var(--secondary);
            background: white;
            color: var(--secondary);
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .filter-btn.active, .filter-btn:hover {
            background: var(--secondary);
            color: white;
        }
        
        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 2rem;
        }
        
        .product-card {
            background-color: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: all 0.3s;
        }
        
        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }
        
        .product-img {
            height: 200px;
            overflow: hidden;
            position: relative;
        }
        
        .product-img img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s ease;
        }
        
        .product-card:hover .product-img img {
            transform: scale(1.05);
        }
        
        .product-badge {
            position: absolute;
            top: 10px;
            left: 10px;
            background-color: var(--danger);
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: bold;
        }
        
        .product-content {
            padding: 1.5rem;
        }
        
        .product-content h3 {
            margin-bottom: 0.5rem;
            color: var(--primary);
        }
        
        .product-price {
            color: var(--secondary);
            font-weight: bold;
            font-size: 1.2rem;
            margin-bottom: 0.5rem;
        }
        
        .old-price {
            text-decoration: line-through;
            color: #999;
            font-size: 0.9rem;
            margin-left: 0.5rem;
        }
        
        .product-rating {
            display: flex;
            align-items: center;
            gap: 5px;
            margin-bottom: 0.5rem;
            color: #f39c12;
        }
        
        .product-rating span {
            color: #666;
            font-size: 0.9rem;
        }
        
        .product-description {
            color: #666;
            margin-bottom: 1rem;
            font-size: 0.9rem;
        }
        
        .quantity-control {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 1rem;
        }
        
        .quantity-btn {
            width: 30px;
            height: 30px;
            border: 1px solid #ddd;
            background: white;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .quantity-input {
            width: 50px;
            height: 30px;
            border: 1px solid #ddd;
            border-radius: 4px;
            text-align: center;
        }
        
        .product-actions {
            display: flex;
            gap: 10px;
        }
        
        .product-actions .btn {
            flex: 1;
            justify-content: center;
        }
        
        /* Shopping Cart */
        .cart-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            display: none;
        }
        
        .cart-overlay.open {
            display: block;
        }
        
        .cart-container {
            position: fixed;
            top: 0;
            right: -400px;
            width: 380px;
            height: 100%;
            background-color: white;
            z-index: 1001;
            display: flex;
            flex-direction: column;
            transition: right 0.3s ease;
            box-shadow: -5px 0 15px rgba(0, 0, 0, 0.1);
        }
        
        .cart-container.open {
            right: 0;
        }
        
        .cart-header {
            padding: 1.5rem;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .cart-header h2 {
            color: var(--primary);
        }
        
        .close-cart {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
        }
        
        .cart-items {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
        }
        
        .cart-item {
            display: flex;
            gap: 10px;
            padding: 1rem 0;
            border-bottom: 1px solid #eee;
        }
        
        .cart-item-img {
            width: 80px;
            height: 80px;
            border-radius: 4px;
            overflow: hidden;
        }
        
        .cart-item-img img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .cart-item-details {
            flex: 1;
        }
        
        .cart-item-details h4 {
            margin-bottom: 0.25rem;
            color: var(--primary);
        }
        
        .cart-item-price {
            color: var(--secondary);
            font-weight: bold;
            margin-bottom: 0.5rem;
        }
        
        .cart-item-quantity {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .cart-item-remove {
            background: none;
            border: none;
            color: var(--danger);
            cursor: pointer;
            font-size: 1.1rem;
        }
        
        .empty-cart-message {
            text-align: center;
            padding: 2rem;
            color: #666;
        }
        
        .empty-cart-message i {
            font-size: 3rem;
            margin-bottom: 1rem;
            color: #ddd;
        }
        
        .cart-footer {
            padding: 1.5rem;
            border-top: 1px solid #eee;
        }
        
        .cart-total {
            display: flex;
            justify-content: space-between;
            margin-bottom: 1rem;
            font-weight: bold;
            font-size: 1.1rem;
        }
        
        .cart-buttons {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        /* About Section */
        .about {
            padding: 4rem 2rem;
            background-color: white;
        }
        
        .about-container {
            max-width: 1000px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 3rem;
            align-items: center;
        }
        
        .about-img {
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }
        
        .about-img img {
            width: 100%;
            height: auto;
            display: block;
        }
        
        .about-content h2 {
            font-size: clamp(1.5rem, 3vw, 2rem);
            color: var(--primary);
            margin-bottom: 1.5rem;
        }
        
        .about-content p {
            margin-bottom: 1.5rem;
            color: #666;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            margin-top: 2rem;
        }
        
        .stat-item {
            text-align: center;
            padding: 1rem;
            background-color: var(--light);
            border-radius: 8px;
        }
        
        .stat-item h3 {
            font-size: 2rem;
            color: var(--secondary);
            margin-bottom: 0.5rem;
        }
        
        .stat-item p {
            font-size: 0.9rem;
            color: #666;
        }
        
        /* Team Section */
        .team {
            padding: 4rem 2rem;
            background-color: var(--light);
        }
        
        .team-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
            margin-top: 2rem;
        }
        
        .team-card {
            background-color: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            text-align: center;
            transition: all 0.3s;
        }
        
        .team-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }
        
        .team-img {
            height: 250px;
            overflow: hidden;
        }
        
        .team-img img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .team-info {
            padding: 1.5rem;
        }
        
        .team-info h3 {
            margin-bottom: 0.5rem;
            color: var(--primary);
        }
        
        .team-info p {
            color: var(--secondary);
            margin-bottom: 1rem;
            font-weight: 500;
        }
        
        .team-info .social-links {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 1rem;
        }
        
        .team-info .social-links a {
            color: var(--primary);
            background-color: var(--light);
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }
        
        .team-info .social-links a:hover {
            background-color: var(--secondary);
            color: white;
        }
        
        /* Testimonials Section */
        .testimonials {
            padding: 4rem 2rem;
            background-color: white;
        }
        
        .testimonial-slider {
            max-width: 800px;
            margin: 2rem auto 0;
            position: relative;
        }
        
        .testimonial {
            background-color: var(--light);
            padding: 2rem;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }
        
        .testimonial-content {
            font-style: italic;
            margin-bottom: 1.5rem;
            color: #555;
            position: relative;
        }
        
        .testimonial-content::before,
        .testimonial-content::after {
            content: '"';
            font-size: 3rem;
            color: var(--secondary);
            opacity: 0.3;
            position: absolute;
        }
        
        .testimonial-content::before {
            top: -20px;
            left: -10px;
        }
        
        .testimonial-content::after {
            bottom: -40px;
            right: -10px;
        }
        
        .testimonial-author {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 2rem;
        }
        
        .author-img {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            overflow: hidden;
            margin-bottom: 1rem;
            border: 3px solid var(--secondary);
        }
        
        .author-img img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .author-info h4 {
            color: var(--primary);
            margin-bottom: 0.25rem;
        }
        
        .author-info p {
            color: #666;
            font-size: 0.9rem;
        }
        
        .slider-nav {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 2rem;
        }
        
        .slider-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background-color: #ddd;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .slider-dot.active {
            background-color: var(--secondary);
            transform: scale(1.2);
        }
        
        /* FAQ Section */
        .faq {
            padding: 4rem 2rem;
            background-color: var(--light);
        }
        
        .faq-container {
            max-width: 800px;
            margin: 0 auto;
        }
        
        .faq-item {
            margin-bottom: 1rem;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        
        .faq-question {
            background-color: white;
            padding: 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .faq-question:hover {
            background-color: #f8f9fa;
        }
        
        .faq-question h3 {
            color: var(--primary);
            font-size: 1.1rem;
        }
        
        .faq-question i {
            transition: transform 0.3s;
        }
        
        .faq-item.active .faq-question i {
            transform: rotate(180deg);
        }
        
        .faq-answer {
            background-color: #f8f9fa;
            padding: 0 1.5rem;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease, padding 0.3s ease;
        }
        
        .faq-item.active .faq-answer {
            padding: 1.5rem;
            max-height: 500px;
        }
        
        .faq-answer p {
            color: #666;
            line-height: 1.7;
        }
        
        /* Contact Section */
        .contact {
            padding: 4rem 2rem;
            background-color: white;
        }
        
        .contact-container {
            max-width: 1000px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 3rem;
        }
        
        .contact-info h2 {
            font-size: clamp(1.5rem, 3vw, 2rem);
            color: var(--primary);
            margin-bottom: 1.5rem;
        }
        
        .contact-info p {
            margin-bottom: 2rem;
            color: #666;
        }
        
        .contact-details {
            margin-bottom: 2rem;
        }
        
        .contact-item {
            display: flex;
            align-items: flex-start;
            gap: 15px;
            margin-bottom: 1.5rem;
        }
        
        .contact-icon {
            background-color: var(--secondary);
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
        
        .contact-text h3 {
            color: var(--primary);
            margin-bottom: 0.25rem;
        }
        
        .contact-text p, .contact-text a {
            color: #666;
            text-decoration: none;
        }
        
        .contact-text a:hover {
            color: var(--secondary);
        }
        
        .contact-map {
            height: 100%;
            min-height: 300px;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .contact-map iframe {
            width: 100%;
            height: 100%;
            border: none;
        }
        
        .contact-form {
            background-color: var(--light);
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        /* Footer */
        footer {
            background-color: var(--primary);
            color: white;
            padding: 3rem 2rem;
        }
        
        .footer-container {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
        }
        
        .footer-col h3 {
            font-size: 1.2rem;
            margin-bottom: 1.5rem;
            position: relative;
            padding-bottom: 0.5rem;
        }
        
        .footer-col h3::after {
            content: '';
            position: absolute;
            left: 0;
            bottom: 0;
            width: 50px;
            height: 2px;
            background-color: var(--secondary);
        }
        
        .footer-col p {
            margin-bottom: 1rem;
            color: #bbb;
        }
        
        .footer-col ul {
            list-style: none;
        }
        
        .footer-col ul li {
            margin-bottom: 0.75rem;
        }
        
        .footer-col ul li a {
            color: #bbb;
            text-decoration: none;
            transition: color 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .footer-col ul li a:hover {
            color: white;
        }
        
        .social-links {
            display: flex;
            gap: 1rem;
        }
        
        .social-links a {
            color: white;
            background-color: rgba(255, 255, 255, 0.1);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.3s;
        }
        
        .social-links a:hover {
            background-color: var(--secondary);
        }
        
        .newsletter-form {
            margin-top: 1rem;
        }
        
        .newsletter-form input {
            width: 100%;
            padding: 0.75rem;
            border: none;
            border-radius: 4px;
            margin-bottom: 0.5rem;
        }
        
        .copyright {
            text-align: center;
            padding-top: 2rem;
            margin-top: 2rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            color: #bbb;
        }
        
        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            display: none;
            justify-content: center;
            align-items: center;
        }
        
        .modal-overlay.active {
            display: flex;
        }
        
        .modal-dialog {
            background: white;
            border-radius: 8px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
        }
        
        .modal-header {
            padding: 1.5rem;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-body {
            padding: 1.5rem;
        }
        
        .modal-footer {
            padding: 1rem 1.5rem;
            border-top: 1px solid #eee;
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
        }
        
        .close-modal {
            position: absolute;
            top: 1rem;
            right: 1rem;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
            transition: color 0.3s;
        }
        
        .close-modal:hover {
            color: var(--danger);
        }
        
        .form-footer {
            margin-top: 1.5rem;
            text-align: center;
            font-size: 0.9rem;
        }
        
        .form-footer a {
            color: var(--secondary);
            text-decoration: none;
            font-weight: 500;
        }
        
        .form-footer a:hover {
            text-decoration: underline;
        }
        
        /* Notification */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 1rem 1.5rem;
            border-radius: 4px;
            color: white;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 15px;
            z-index: 10000;
            transform: translateX(100%);
            transition: transform 0.3s ease;
            max-width: 350px;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification.success {
            background-color: var(--success);
        }
        
        .notification.error {
            background-color: var(--danger);
        }
        
        .notification.info {
            background-color: var(--info);
        }
        
        .notification.warning {
            background-color: var(--warning);
        }
        
        .close-notification {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            font-size: 1.2rem;
        }
        
        /* Form Styles */
        .form-group {
            margin-bottom: 1rem;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--primary);
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }
        
        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--secondary);
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }
        
        /* Additional styles for user authentication */
        .auth-required {
            position: relative;
        }
        
        .auth-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.9);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            z-index: 10;
            padding: 1rem;
            text-align: center;
        }
        
        .auth-overlay h3 {
            margin-bottom: 1rem;
            color: var(--primary);
        }
        
        .auth-overlay p {
            margin-bottom: 1.5rem;
            color: #666;
        }
        
        .login-prompt {
            background-color: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 4px;
            padding: 1rem;
            margin-bottom: 1rem;
            text-align: center;
        }
        
        .user-profile {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            position: relative;
        }
        
        .user-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            background: white;
            border-radius: 4px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            padding: 0.5rem 0;
            min-width: 150px;
            z-index: 1000;
            display: none;
        }
        
        .user-dropdown a {
            display: block;
            padding: 0.5rem 1rem;
            color: var(--dark);
            text-decoration: none;
            transition: background-color 0.3s;
        }
        
        .user-dropdown a:hover {
            background-color: var(--light);
        }
        
        .user-profile:hover .user-dropdown {
            display: block;
        }
        
        /* Appointment Modal Styles */
        .appointment-modal .modal-dialog {
            max-width: 700px;
        }
        
        .appointment-form {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }
        
        .appointment-form .form-group {
            margin-bottom: 1rem;
        }
        
        .appointment-form .full-width {
            grid-column: 1 / -1;
        }
        
        .appointment-calendar {
            margin-bottom: 1.5rem;
        }
        
        .time-slots {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 0.5rem;
            margin-top: 1rem;
        }
        
        .time-slot {
            padding: 0.5rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .time-slot:hover {
            background-color: #f0f0f0;
        }
        
        .time-slot.selected {
            background-color: var(--secondary);
            color: white;
            border-color: var(--secondary);
        }
        
        .time-slot.unavailable {
            background-color: #f8f8f8;
            color: #999;
            cursor: not-allowed;
        }
        
        /* User Dashboard */
        .dashboard {
            padding: 2rem;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .dashboard-section {
            background: white;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .dashboard-section h3 {
            color: var(--primary);
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--light);
        }
        
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
        }
        
        .dashboard-card {
            background: var(--light);
            padding: 1rem;
            border-radius: 6px;
            border-left: 4px solid var(--secondary);
        }
        
        .dashboard-card h4 {
            color: var(--primary);
            margin-bottom: 0.5rem;
        }
        
        .dashboard-card p {
            color: #666;
            margin-bottom: 0.5rem;
        }
        
        .dashboard-card .status {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: bold;
        }
        
        .status-pending { background: #fff3cd; color: #856404; }
        .status-confirmed { background: #d1ecf1; color: #0c5460; }
        .status-completed { background: #d4edda; color: #155724; }
        .status-cancelled { background: #f8d7da; color: #721c24; }
        
        /* Admin specific styles */
        .admin-panel {
            background: #f8f9fa;
            border-left: 4px solid var(--danger);
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .stat-card {
            background: white;
            padding: 1.5rem;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .stat-card .number {
            font-size: 2rem;
            font-weight: bold;
            color: var(--secondary);
            display: block;
        }
        
        .stat-card .label {
            color: #666;
            font-size: 0.9rem;
        }
        
        /* Loading Spinner */
        .loading-spinner {
            display: none;
            text-align: center;
            padding: 2rem;
        }
        
        .loading-spinner i {
            font-size: 2rem;
            color: var(--secondary);
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Stock Status */
        .stock-status {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: bold;
            margin-left: 0.5rem;
        }
        
        .in-stock {
            background-color: var(--success);
            color: white;
        }
        
        .low-stock {
            background-color: var(--warning);
            color: white;
        }
        
        .out-of-stock {
            background-color: var(--danger);
            color: white;
        }
        
        /* Payment Modal Styles */
        .payment-methods {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin: 1.5rem 0;
        }

        .payment-method {
            border: 2px solid #ddd;
            border-radius: 8px;
            padding: 1rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background: white;
        }

        .payment-method:hover {
            border-color: var(--secondary);
            background: #f8f9fa;
        }

        .payment-method.selected {
            border-color: var(--secondary);
            background: var(--light);
        }

        .payment-method i {
            font-size: 2rem;
            margin-bottom: 0.5rem;
            color: var(--secondary);
        }

        .payment-form {
            margin-top: 1.5rem;
        }

        .payment-form-section {
            display: none;
        }

        .payment-form-section.active {
            display: block;
        }

        .card-element {
            padding: 1rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-bottom: 1rem;
        }

        .card-errors {
            color: var(--danger);
            font-size: 0.9rem;
            margin-top: 0.5rem;
        }

        .payment-summary {
            background: var(--light);
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1.5rem;
        }

        .summary-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }

        .summary-total {
            font-weight: bold;
            font-size: 1.1rem;
            border-top: 1px solid #ddd;
            padding-top: 0.5rem;
            margin-top: 0.5rem;
        }

        /* Order Success Modal */
        .order-success {
            text-align: center;
            padding: 2rem;
        }

        .order-success i {
            font-size: 4rem;
            color: var(--success);
            margin-bottom: 1rem;
        }

        .order-details {
            background: var(--light);
            padding: 1.5rem;
            border-radius: 8px;
            margin: 1.5rem 0;
            text-align: left;
        }

        .order-detail-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }

        .order-detail-item:last-child {
            margin-bottom: 0;
            font-weight: bold;
            border-top: 1px solid #ddd;
            padding-top: 0.5rem;
        }

        /* Loading States */
        .payment-processing {
            text-align: center;
            padding: 2rem;
        }

        .payment-processing i {
            font-size: 3rem;
            color: var(--secondary);
            margin-bottom: 1rem;
        }

        /* Additional styles for payment */
        .payment-security {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 1rem;
            color: #666;
            font-size: 0.9rem;
        }

        .payment-security i {
            color: var(--success);
        }

        .billing-address {
            margin-top: 1.5rem;
        }

        /* Enhanced Cart Styles */
        .cart-item-stock {
            font-size: 0.8rem;
            color: #666;
            margin-top: 0.25rem;
        }

        .stock-warning {
            color: var(--warning);
        }

        .stock-error {
            color: var(--danger);
        }

        /* Bank Details */
        .bank-details {
            background: var(--light);
            padding: 1.5rem;
            border-radius: 8px;
            margin: 1rem 0;
        }

        .bank-detail-item {
            margin-bottom: 0.75rem;
            padding-bottom: 0.75rem;
            border-bottom: 1px solid #ddd;
        }

        .bank-detail-item:last-child {
            margin-bottom: 0;
            border-bottom: none;
        }

        /* Responsive Styles */
        @media (max-width: 768px) {
            header {
                flex-direction: column;
                gap: 1rem;
                padding: 1rem;
            }
            
            nav ul {
                display: none;
            }
            
            .hero {
                min-height: 60vh;
                padding: 1rem;
            }
            
            .hero h2 {
                font-size: 2rem;
            }
            
            .hero p {
                font-size: 1rem;
            }
            
            .about-container,
            .contact-container {
                grid-template-columns: 1fr;
            }
            
            .contact-map {
                min-height: 400px;
                order: -1;
            }
            
            .appointment-form {
                grid-template-columns: 1fr;
            }
            
            .time-slots {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .cart-container {
                width: 100%;
                right: -100%;
            }
            
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .services, .products, .about, .team, .testimonials, .faq, .contact {
                padding: 2rem 1rem;
            }

            .payment-methods {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 576px) {
            .hero-buttons {
                flex-direction: column;
                width: 100%;
            }
            
            .hero-buttons .btn {
                width: 100%;
                justify-content: center;
            }
            
            .emergency-banner {
                position: static;
                margin-bottom: 1rem;
                width: 100%;
                justify-content: center;
            }
            
            .product-actions {
                flex-direction: column;
            }
            
            .time-slots {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .modal-dialog {
                width: 95%;
                margin: 1rem;
            }
            
            .stats {
                grid-template-columns: 1fr;
            }
        }
        
        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        /* Utility Classes */
        .text-center {
            text-align: center;
        }
        
        .mb-1 { margin-bottom: 0.5rem; }
        .mb-2 { margin-bottom: 1rem; }
        .mb-3 { margin-bottom: 1.5rem; }
        .mb-4 { margin-bottom: 2rem; }
        
        .mt-1 { margin-top: 0.5rem; }
        .mt-2 { margin-top: 1rem; }
        .mt-3 { margin-top: 1.5rem; }
        .mt-4 { margin-top: 2rem; }
    </style>
</head>
<body>
    <!-- Public Website -->
    <div id="public-website">
        <header>
            <div class="logo">
                <img src="https://via.placeholder.com/50x50?text=PDSA" alt="PDSA Logo">
                <h1>PDSA Veterinary Clinic</h1>
            </div>
            <nav>
                <ul>
                    <li><a href="#home" class="active">Home</a></li>
                    <li><a href="#services">Services</a></li>
                    <li><a href="#products">Products</a></li>
                    <li><a href="#about">About Us</a></li>
                    <li><a href="#team">Our Team</a></li>
                    <li><a href="#contact">Contact</a></li>
                </ul>
            </nav>
            <div class="auth-buttons">
                <div class="cart-icon" id="cart-btn">
                    <i class="fas fa-shopping-cart"></i>
                    <span class="cart-count">0</span>
                </div>
                <button class="btn btn-outline" id="login-btn">
                    <i class="fas fa-sign-in-alt"></i> Login
                </button>
                <button class="btn btn-primary" id="register-btn">
                    <i class="fas fa-user-plus"></i> Register
                </button>
                <a href="admin-product.html" class="admin-link" id="admin-link" style="display: none;">
                    <i class="fas fa-cog"></i> Admin
                </a>
                <div id="user-menu" style="display: none;">
                    <div class="user-profile">
                        <span id="user-name"></span>
                        <i class="fas fa-chevron-down"></i>
                        <div class="user-dropdown">
                            <a href="index.html" id="user-dashboard-link">Dashboard</a>
                            <a href="profile.html" id="user-profile-link">My Profile</a>
                            <a href="my-pets.html" id="my-pets-link">My Pets</a>
                            <a href="appointments.html" id="my-appointments-link">Appointments</a>
                            <a href="orders.html" id="my-orders-link">Orders</a>
                            <a href="#" id="logout-link">Logout</a>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <section class="hero" id="home">
            <a href="tel:011 984 4340" class="emergency-banner" id="emergency-banner">
                <i class="fas fa-phone-alt"></i>
                <span>Emergency: 011 984 4340</span>
            </a>
            <h2>Compassionate Care for Your Pets</h2>
            <p>PDSA provides quality veterinary services to pets in Mfolo, Soweto. Book an appointment today and give your pet the care they deserve.</p>
            <div class="hero-buttons">
                <button class="btn btn-primary" id="book-appointment-btn">
                    <i class="fas fa-calendar-alt"></i> Book Appointment
                </button>
                <button class="btn btn-outline" id="learn-more-btn">
                    <i class="fas fa-info-circle"></i> Learn More
                </button>
            </div>
        </section>

        <section class="services" id="services">
            <div class="section-title">
                <h2>Our Services</h2>
                <p>We offer a wide range of veterinary services to keep your pets healthy and happy.</p>
            </div>
            <div class="services-grid">
                <div class="service-card">
                    <div class="service-img">
                        <img src="https://images.unsplash.com/photo-1583337130417-3346a1be7dee?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1964&q=80" alt="Vaccination">
                    </div>
                    <div class="service-content">
                        <h3>Vaccinations</h3>
                        <div class="price">From R250</div>
                        <p>Protect your pet from preventable diseases with our comprehensive vaccination programs tailored to your pet's needs.</p>
                        <div class="service-meta">
                            <span><i class="fas fa-clock"></i> 30 mins</span>
                            <span><i class="fas fa-calendar-alt"></i> Annual</span>
                        </div>
                        <button class="btn btn-primary mt-2" style="width: 100%;">
                            <i class="fas fa-info-circle"></i> Learn More
                        </button>
                    </div>
                </div>
                <div class="service-card">
                    <div class="service-img">
                        <img src="https://images.unsplash.com/photo-1583337130417-3346a1be7dee?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1964&q=80" alt="Surgery">
                    </div>
                    <div class="service-content">
                        <h3>Surgical Procedures</h3>
                        <div class="price">From R800</div>
                        <p>From routine spaying/neutering to complex surgeries, our experienced veterinary surgeons provide compassionate care.</p>
                        <div class="service-meta">
                            <span><i class="fas fa-clock"></i> 1-3 hours</span>
                            <span><i class="fas fa-procedures"></i> Hospitalization</span>
                        </div>
                        <button class="btn btn-primary mt-2" style="width: 100%;">
                            <i class="fas fa-info-circle"></i> Learn More
                        </button>
                    </div>
                </div>
                <div class="service-card">
                    <div class="service-img">
                        <img src="https://images.unsplash.com/photo-1544568100-847a948585b9?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1974&q=80" alt="Dental Care">
                    </div>
                    <div class="service-content">
                        <h3>Dental Care</h3>
                        <div class="price">From R450</div>
                        <p>Comprehensive dental services including cleaning, extractions, and oral health assessments to maintain your pet's smile.</p>
                        <div class="service-meta">
                            <span><i class="fas fa-clock"></i> 45 mins</span>
                            <span><i class="fas fa-tooth"></i> Annual Check</span>
                        </div>
                        <button class="btn btn-primary mt-2" style="width: 100%;">
                            <i class="fas fa-info-circle"></i> Learn More
                        </button>
                    </div>
                </div>
                <div class="service-card">
                    <div class="service-img">
                        <img src="https://images.unsplash.com/photo-1583337130417-3346a1be7dee?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1964&q=80" alt="Microchipping">
                    </div>
                    <div class="service-content">
                        <h3>Microchipping</h3>
                        <div class="price">R350</div>
                        <p>Ensure your pet can always be identified with our quick and painless microchipping service.</p>
                        <div class="service-meta">
                            <span><i class="fas fa-clock"></i> 15 mins</span>
                            <span><i class="fas fa-id-card"></i> Lifetime</span>
                        </div>
                        <button class="btn btn-primary mt-2" style="width: 100%;">
                            <i class="fas fa-info-circle"></i> Learn More
                        </button>
                    </div>
                </div>
                <div class="service-card">
                    <div class="service-img">
                        <img src="https://images.unsplash.com/photo-1583337130417-3346a1be7dee?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1964&q=80" alt="Nutrition">
                    </div>
                    <div class="service-content">
                        <h3>Nutrition Counseling</h3>
                        <div class="price">From R300</div>
                        <p>Tailored dietary plans to address weight management, allergies, or specific health conditions for optimal pet health.</p>
                        <div class="service-meta">
                            <span><i class="fas fa-clock"></i> 45 mins</span>
                            <span><i class="fas fa-utensils"></i> Follow-ups</span>
                        </div>
                        <button class="btn btn-primary mt-2" style="width: 100%;">
                            <i class="fas fa-info-circle"></i> Learn More
                        </button>
                    </div>
                </div>
                <div class="service-card">
                    <div class="service-img">
                        <img src="https://images.unsplash.com/photo-1575425186775-b8de9a427e67?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=687&q=80" alt="Grooming">
                    </div>
                    <div class="service-content">
                        <h3>Professional Grooming</h3>
                        <div class="price">From R250</div>
                        <p>Full-service grooming including bathing, haircuts, nail trimming, and ear cleaning by our gentle professionals.</p>
                        <div class="service-meta">
                            <span><i class="fas fa-clock"></i> 1-2 hours</span>
                            <span><i class="fas fa-spa"></i> Monthly</span>
                        </div>
                        <button class="btn btn-primary mt-2" style="width: 100%;">
                            <i class="fas fa-info-circle"></i> Learn More
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <section class="products" id="products">
            <div class="section-title">
                <h2>Pet Products</h2>
                <p>Shop our selection of high-quality pet supplies, food, and accessories.</p>
            </div>
            
            <div class="product-filters">
                <button class="filter-btn active" data-filter="all">All Products</button>
                <button class="filter-btn" data-filter="food">Food & Treats</button>
                <button class="filter-btn" data-filter="toys">Toys</button>
                <button class="filter-btn" data-filter="health">Health & Wellness</button>
                <button class="filter-btn" data-filter="accessories">Accessories</button>
                <button class="filter-btn" data-filter="grooming">Grooming</button>
                <button class="filter-btn" data-filter="medication">Medication</button>
            </div>
            
            <!-- Loading State -->
            <div id="products-loading" class="loading-spinner" style="text-align: center; padding: 3rem;">
                <i class="fas fa-spinner fa-spin" style="font-size: 3rem; color: var(--secondary);"></i>
                <p style="margin-top: 1rem;">Loading products...</p>
            </div>
            
            <!-- Empty State -->
            <div id="products-empty" class="empty-state" style="display: none; text-align: center; padding: 3rem;">
                <i class="fas fa-box-open" style="font-size: 4rem; color: #ddd; margin-bottom: 1rem;"></i>
                <h3 style="color: #666; margin-bottom: 1rem;">No Products Available</h3>
                <p style="color: #888; margin-bottom: 2rem;">Check back soon for our latest pet products!</p>
                <button class="btn btn-primary" id="initialize-products-btn">
                    <i class="fas fa-plus"></i> Add Sample Products
                </button>
            </div>
            
            <!-- Products Grid -->
            <div class="products-grid" id="products-grid" style="display: none;">
                <!-- Products will be loaded dynamically from Firebase -->
            </div>
            
            <!-- Load More Button -->
            <div class="load-more-container" style="text-align: center; margin-top: 2rem; display: none;" id="load-more-container">
                <button class="btn btn-outline" id="load-more-btn">
                    <i class="fas fa-redo"></i> Load More Products
                </button>
            </div>
        </section>

        <section class="about" id="about">
            <div class="about-container">
                <div class="about-img">
                    <img src="https://images.unsplash.com/photo-1583512603805-3cc6b41f3edb?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2080&q=80" alt="PDSA Clinic">
                </div>
                <div class="about-content">
                    <h2>About PDSA Veterinary Clinic</h2>
                    <p>Founded in 2010, PDSA Veterinary Clinic has been serving the Mfolo community with dedication and compassion. We believe that every pet deserves to live a happy and healthy life.</p>
                    <p>Our modern clinic is equipped with state-of-the-art facilities and staffed by compassionate professionals dedicated to providing the highest standard of care for your beloved pets.</p>
                    <p>We offer a range of services from routine check-ups to complex surgical procedures, all delivered with kindness and expertise.</p>
                    
                    <div class="stats">
                        <div class="stat-item">
                            <h3>10+</h3>
                            <p>Years of Service</p>
                        </div>
                        <div class="stat-item">
                            <h3>5K+</h3>
                            <p>Pets Treated Annually</p>
                        </div>
                        <div class="stat-item">
                            <h3>24/7</h3>
                            <p>Emergency Care</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section class="team" id="team">
            <div class="section-title">
                <h2>Meet Our Team</h2>
                <p>Our dedicated team of veterinary professionals are here to provide the best care for your pets.</p>
            </div>
            <div class="team-grid">
                <div class="team-card">
                    <div class="team-img">
                        <img src="https://randomuser.me/api/portraits/women/65.jpg" alt="Dr. Sarah Johnson">
                    </div>
                    <div class="team-info">
                        <h3>Dr. Sarah Johnson</h3>
                        <p>Head Veterinarian</p>
                        <p>Specializes in small animal surgery with 15 years of experience.</p>
                        <div class="social-links">
                            <a href="#"><i class="fab fa-linkedin-in"></i></a>
                            <a href="#"><i class="fas fa-envelope"></i></a>
                        </div>
                    </div>
                </div>
                <div class="team-card">
                    <div class="team-img">
                        <img src="https://randomuser.me/api/portraits/men/32.jpg" alt="Dr. Mahlangu Browns">
                    </div>
                    <div class="team-info">
                        <h3>Dr. Mahlangu Browns</h3>
                        <p>Senior Veterinarian</p>
                        <p>Expert in internal medicine and chronic conditions.</p>
                        <div class="social-links">
                            <a href="#"><i class="fab fa-linkedin-in"></i></a>
                            <a href="#"><i class="fas fa-envelope"></i></a>
                        </div>
                    </div>
                </div>
                <div class="team-card">
                    <div class="team-img">
                        <img src="https://randomuser.me/api/portraits/women/44.jpg" alt="Dr. Emma Mathada">
                    </div>
                    <div class="team-info">
                        <h3>Dr. Emma Mathada</h3>
                        <p>Emergency Veterinarian</p>
                        <p>Available 24/7 for critical and emergency cases.</p>
                        <div class="social-links">
                            <a href="#"><i class="fab fa-linkedin-in"></i></a>
                            <a href="#"><i class="fas fa-envelope"></i></a>
                        </div>
                    </div>
                </div>
                <div class="team-card">
                    <div class="team-img">
                        <img src="https://randomuser.me/api/portraits/men/76.jpg" alt="David Lee">
                    </div>
                    <div class="team-info">
                        <h3>David Ledwaba</h3>
                        <p>Veterinary nurse</p>
                        <p>Specialized in postoperative care and rehabilitation.</p>
                        <div class="social-links">
                            <a href="#"><i class="fab fa-linkedin-in"></i></a>
                            <a href="#"><i class="fas fa-envelope"></i></a>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section class="testimonials">
            <div class="section-title">
                <h2>What Our Clients Say</h2>
                <p>Hear from pet owners who have trusted us with their furry family members.</p>
            </div>
            <div class="testimonial-slider">
                <div class="testimonial">
                    <div class="testimonial-content">
                        The care my dog received at PDSA was exceptional. When Max needed emergency surgery, the team acted quickly and professionally. They kept me informed throughout the entire process and showed genuine compassion for both me and my pet.
                    </div>
                    <div class="testimonial-author">
                        <div class="author-img">
                            <img src="https://randomuser.me/api/portraits/women/33.jpg" alt="Lisa Chen">
                        </div>
                        <div class="author-info">
                            <h4>Lisanda Mabuza</h4>
                            <p>Dog Owner</p>
                        </div>
                    </div>
                </div>
                <div class="slider-nav">
                    <div class="slider-dot active"></div>
                    <div class="slider-dot"></div>
                    <div class="slider-dot"></div>
                </div>
            </div>
        </section>

        <section class="faq" id="faq">
            <div class="section-title">
                <h2>Frequently Asked Questions</h2>
                <p>Find answers to common questions about our services and policies.</p>
            </div>
            <div class="faq-container">
                <div class="faq-item">
                    <div class="faq-question">
                        <h3>What are your opening hours?</h3>
                        <i class="fas fa-chevron-down"></i>
                    </div>
                    <div class="faq-answer">
                        <p>Our clinic is open Monday to Friday from 8:00 AM to 7:00 PM, and Saturdays from 9:00 AM to 4:00 PM. We are closed on Sundays except for emergency cases. Our 24/7 emergency service is always available for critical cases.</p>
                    </div>
                </div>
                <div class="faq-item">
                    <div class="faq-question">
                        <h3>Do I need to register my pet before booking an appointment?</h3>
                        <i class="fas fa-chevron-down"></i>
                    </div>
                    <div class="faq-answer">
                        <p>Yes, we require all pets to be registered with our clinic before their first appointment. You can register your pet online through our portal or in person at the clinic. Registration helps us maintain complete medical records for your pet and ensures we can provide the best possible care.</p>
                    </div>
                </div>
                <div class="faq-item">
                    <div class="faq-question">
                        <h3>What payment methods do you accept?</h3>
                        <i class="fas fa-chevron-down"></i>
                    </div>
                    <div class="faq-answer">
                        <p>We accept all major credit and debit cards (Visa, MasterCard, American Express), cash, and contactless payments. We also offer payment plans for certain procedures - please ask our reception staff for details.</p>
                    </div>
                </div>
                <div class="faq-item">
                    <div class="faq-question">
                        <h3>How do I know if my pet needs emergency care?</h3>
                        <i class="fas fa-chevron-down"></i>
                    </div>
                    <div class="faq-answer">
                        <p>Signs that your pet may need emergency care include difficulty breathing, seizures, uncontrolled bleeding, sudden paralysis, loss of consciousness, bloated or distented abdomen, poisoning, severe trauma (like being hit by a car), inability to urinate or defecate, or extreme pain. If you're unsure, please call our emergency line immediately at 011 984 4340.</p>
                    </div>
                </div>
                <div class="faq-item">
                    <div class="faq-question">
                        <h3>Do you offer pet insurance claims?</h3>
                        <i class="fas fa-chevron-down"></i>
                    </div>
                    <div class="faq-answer">
                        <p>Yes, we work with most pet insurance providers. You will need to pay for the treatment upfront and then claim back from your insurer. Our team can provide all necessary documentation to support your claim. Some insurance companies offer direct claims - please check with your provider and inform our reception staff when you arrive.</p>
                    </div>
                </div>
            </div>
        </section>

        <section class="contact" id="contact">
            <div class="contact-container">
                <div class="contact-info">
                    <h2>Contact Us</h2>
                    <p>Have questions or need to get in touch? We're here to help you and your pet.</p>
                    
                    <div class="contact-details">
                        <div class="contact-item">
                            <div class="contact-icon">
                                <i class="fas fa-map-marker-alt"></i>
                            </div>
                            <div class="contact-text">
                                <h3>Our Location</h3>
                                <p>1188 Nancefield Moroka Road, Mfolo South, Soweto, 1868</p>
                            </div>
                        </div>
                        <div class="contact-item">
                            <div class="contact-icon">
                                <i class="fas fa-phone-alt"></i>
                            </div>
                            <div class="contact-text">
                                <h3>Call Us</h3>
                                <p>Main: 011 984 4340</p>
                                <p>Emergency: 011 984 4340</p>
                            </div>
                        </div>
                        <div class="contact-item">
                            <div class="contact-icon">
                                <i class="fas fa-envelope"></i>
                            </div>
                            <div class="contact-text">
                                <h3>Email Us</h3>
                                <a href="mailto:info@pdsa.org.za">info@pdsa.org.za</a>
                            </div>
                        </div>
                        <div class="contact-item">
                            <div class="contact-icon">
                                <i class="fas fa-clock"></i>
                            </div>
                            <div class="contact-text">
                                <h3>Opening Hours</h3>
                                <p>Mon-Fri: 8:00 AM - 7:00 PM</p>
                                <p>Sat: 9:00 AM - 4:00 PM</p>
                                <p>Sun: Emergency only</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="social-links">
                        <a href="#"><i class="fab fa-facebook-f"></i></a>
                        <a href="#"><i class="fab fa-twitter"></i></a>
                        <a href="#"><i class="fab fa-instagram"></i></a>
                        <a href="#"><i class="fab fa-linkedin-in"></i></a>
                    </div>
                </div>
                <div class="contact-map">
                    <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3576.340050682773!2d27.8589117764842!3d-26.31534437691821!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x1e95a6c8d3c5f1c5%3A0x7c3d5e5a5a5a5a5a!2sMfolo%2C%20Soweto%2C%201868!5e0!3m2!1sen!2sza!4v1686754321235!5m2!1sen!2sza" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
                </div>
                <div class="contact-form">
                    <h3>Send Us a Message</h3>
                    <form id="contact-form">
                        <div class="form-group">
                            <label for="contact-name">Your Name</label>
                            <input type="text" id="contact-name" name="name" required>
                        </div>
                        <div class="form-group">
                            <label for="contact-email">Email</label>
                            <input type="email" id="contact-email" name="email" required>
                        </div>
                        <div class="form-group">
                            <label for="contact-phone">Phone Number</label>
                            <input type="tel" id="contact-phone" name="phone">
                        </div>
                        <div class="form-group">
                            <label for="contact-subject">Subject</label>
                            <select id="contact-subject" name="subject">
                                <option value="general">General Inquiry</option>
                                <option value="appointment">Appointment Question</option>
                                <option value="emergency">Emergency</option>
                                <option value="feedback">Feedback</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="contact-message">Message</label>
                            <textarea id="contact-message" name="message" required></textarea>
                        </div>
                        <button type="submit" class="btn btn-primary" style="width: 100%;">
                            <i class="fas fa-paper-plane"></i> Send Message
                        </button>
                    </form>
                </div>
            </div>
        </section>

        <footer>
            <div class="footer-container">
                <div class="footer-col">
                    <h3>About PDSA</h3>
                    <p>PDSA is Soweto's leading veterinary clinic. We've been taking care of the community's pets since 2010, providing quality veterinary services to pets in need.</p>
                    <div class="social-links">
                        <a href="#"><i class="fab fa-facebook-f"></i></a>
                        <a href="#"><i class="fab fa-twitter"></i></a>
                        <a href="#"><i class="fab fa-instagram"></i></a>
                        <a href="#"><i class="fab fa-linkedin-in"></i></a>
                    </div>
                </div>
                <div class="footer-col">
                    <h3>Quick Links</h3>
                    <ul>
                        <li><a href="#home"><i class="fas fa-chevron-right"></i> Home</a></li>
                        <li><a href="#services"><i class="fas fa-chevron-right"></i> Services</a></li>
                        <li><a href="#products"><i class="fas fa-chevron-right"></i> Products</a></li>
                        <li><a href="#about"><i class="fas fa-chevron-right"></i> About Us</a></li>
                        <li><a href="#team"><i class="fas fa-chevron-right"></i> Our Team</a></li>
                        <li><a href="#contact"><i class="fas fa-chevron-right"></i> Contact</a></li>
                </div>
                <div class="footer-col">
                    <h3>Services</h3>
                    <ul>
                        <li><a href="veterinaryclinic.html"><i class="fas fa-chevron-right"></i> Vaccinations</a></li>
                        <li><a href="Surgical-Procedures.html"><i class="fas fa-chevron-right"></i> Surgical Procedures</a></li>
                        <li><a href="dental-care.html"><i class="fas fa-chevron-right"></i> Dental Care</a></li>
                        <li><a href="emergency-care.html"><i class="fas fa-chevron-right"></i> Emergency Care</a></li>
                        
                    </ul>
                </div>
                <div class="footer-col">
                    <h3>Newsletter</h3>
                    <p>Subscribe to our newsletter for pet care tips, clinic updates, and special offers.</p>
                    <div class="newsletter-form">
                        <input type="email" placeholder="Your email address">
                        <button class="btn btn-primary" style="width: 100%;">Subscribe</button>
                    </div>
                </div>
            </div>
            <div class="copyright">
                <p>&copy; 2023 PDSA Veterinary Clinic. All rights reserved.</p>
            </div>
        </footer>
    </div>

    <!-- Shopping Cart -->
    <div class="cart-overlay" id="cart-overlay"></div>
    <div class="cart-container" id="cart-container">
        <div class="cart-header">
            <h2>Your Shopping Cart</h2>
            <button class="close-cart" id="close-cart">&times;</button>
        </div>
        <div class="cart-items" id="cart-items">
            <div class="empty-cart-message" id="empty-cart-message">
                <i class="fas fa-shopping-cart"></i>
                <p>Your cart is empty</p>
                <a href="#products" class="btn btn-primary">Continue Shopping</a>
            </div>
        </div>
        <div class="cart-footer">
            <div class="cart-total">
                <span>Total:</span>
                <span id="cart-total-amount">R0.00</span>
            </div>
            <div class="cart-buttons">
                <button class="btn btn-outline" id="continue-shopping">Continue Shopping</button>
                <button class="btn btn-primary" id="checkout-btn" disabled>Proceed to Checkout</button>
            </div>
        </div>
    </div>

    <!-- Enhanced Payment Modal -->
    <div class="modal-overlay" id="payment-modal">
        <div class="modal-dialog" style="max-width: 600px;">
            <div class="modal-header">
                <h2>Complete Your Order</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div id="payment-step-1">
                    <div class="payment-summary">
                        <h3>Order Summary</h3>
                        <div id="payment-order-items">
                            <!-- Order items will be populated here -->
                        </div>
                        <div class="summary-item">
                            <span>Subtotal:</span>
                            <span id="payment-subtotal">R0.00</span>
                        </div>
                        <div class="summary-item">
                            <span>Shipping:</span>
                            <span id="payment-shipping">R0.00</span>
                        </div>
                        <div class="summary-item">
                            <span>Tax:</span>
                            <span id="payment-tax">R0.00</span>
                        </div>
                        <div class="summary-item summary-total">
                            <span>Total:</span>
                            <span id="payment-total">R0.00</span>
                        </div>
                    </div>

                    <h3>Select Payment Method</h3>
                    <div class="payment-methods">
                        <div class="payment-method" data-method="card" onclick="selectPaymentMethod('card')">
                            <i class="fas fa-credit-card"></i>
                            <h4>Credit/Debit Card</h4>
                            <p>Pay securely with your card</p>
                        </div>
                        <div class="payment-method" data-method="eft" onclick="selectPaymentMethod('eft')">
                            <i class="fas fa-university"></i>
                            <h4>Bank Transfer</h4>
                            <p>EFT payment</p>
                        </div>
                        <div class="payment-method" data-method="cash" onclick="selectPaymentMethod('cash')">
                            <i class="fas fa-money-bill-wave"></i>
                            <h4>Cash on Delivery</h4>
                            <p>Pay when you receive</p>
                        </div>
                    </div>

                    <div class="billing-address">
                        <h3>Billing Address</h3>
                        <div class="form-group">
                            <label for="billing-address">Address</label>
                            <textarea id="billing-address" rows="3" placeholder="Enter your billing address"></textarea>
                        </div>
                    </div>

                    <div class="modal-footer">
                        <button class="btn btn-outline" onclick="closePaymentModal()">Cancel</button>
                        <button class="btn btn-primary" id="proceed-to-payment" onclick="proceedToPayment()" disabled>
                            Proceed to Payment
                        </button>
                    </div>
                </div>

                <div id="payment-step-2" style="display: none;">
                    <!-- Card Payment Form -->
                    <div class="payment-form-section" id="card-payment-form">
                        <h3>Card Payment</h3>
                        <div class="card-element" id="card-element">
                            <!-- Stripe card element will be inserted here -->
                        </div>
                        <div class="card-errors" id="card-errors"></div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="card-name">Name on Card</label>
                                <input type="text" id="card-name" placeholder="John Doe">
                            </div>
                        </div>

                        <div class="payment-security">
                            <i class="fas fa-lock"></i>
                            <span>Your payment information is secure and encrypted</span>
                        </div>

                        <div class="modal-footer">
                            <button class="btn btn-outline" onclick="backToPaymentMethods()">Back</button>
                            <button class="btn btn-primary" id="pay-now-btn" onclick="processCardPayment()">
                                <i class="fas fa-lock"></i> Pay Now
                            </button>
                        </div>
                    </div>

                    <!-- EFT Payment Form -->
                    <div class="payment-form-section" id="eft-payment-form">
                        <h3>Bank Transfer Details</h3>
                        <div class="bank-details">
                            <div class="bank-detail-item">
                                <strong>Bank:</strong> Standard Bank
                            </div>
                            <div class="bank-detail-item">
                                <strong>Account Name:</strong> PDSA Veterinary Clinic
                            </div>
                            <div class="bank-detail-item">
                                <strong>Account Number:</strong> 0123456789
                            </div>
                            <div class="bank-detail-item">
                                <strong>Branch Code:</strong> 051001
                            </div>
                            <div class="bank-detail-item">
                                <strong>Reference:</strong> <span id="eft-reference">ORD-123456</span>
                            </div>
                        </div>
                        <p style="margin-top: 1rem; color: #666;">
                            Please use the reference number above when making your payment. 
                            Your order will be processed once payment is confirmed.
                        </p>

                        <div class="modal-footer">
                            <button class="btn btn-outline" onclick="backToPaymentMethods()">Back</button>
                            <button class="btn btn-primary" onclick="confirmEFTPayment()">
                                Confirm EFT Payment
                            </button>
                        </div>
                    </div>

                    <!-- Cash Payment Form -->
                    <div class="payment-form-section" id="cash-payment-form">
                        <h3>Cash on Delivery</h3>
                        <p>You will pay when you receive your order. Please have the exact amount ready.</p>
                        <div class="payment-summary">
                            <h4>Amount to Pay:</h4>
                            <div class="summary-total" id="cash-amount">R0.00</div>
                        </div>

                        <div class="modal-footer">
                            <button class="btn btn-outline" onclick="backToPaymentMethods()">Back</button>
                            <button class="btn btn-primary" onclick="confirmCashPayment()">
                                Confirm Cash Order
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Payment Processing -->
                <div id="payment-processing" style="display: none;">
                    <div class="payment-processing">
                        <i class="fas fa-spinner fa-spin"></i>
                        <h3>Processing Payment</h3>
                        <p>Please wait while we process your payment...</p>
                    </div>
                </div>

                <!-- Order Success -->
                <div id="order-success" style="display: none;">
                    <div class="order-success">
                        <i class="fas fa-check-circle"></i>
                        <h3>Payment Successful!</h3>
                        <p>Thank you for your order. Your payment has been processed successfully.</p>
                        
                        <div class="order-details">
                            <h4>Order Details</h4>
                            <div class="order-detail-item">
                                <span>Order Number:</span>
                                <span id="success-order-number">ORD-123456</span>
                            </div>
                            <div class="order-detail-item">
                                <span>Total Amount:</span>
                                <span id="success-order-total">R0.00</span>
                            </div>
                            <div class="order-detail-item">
                                <span>Payment Method:</span>
                                <span id="success-payment-method">Credit Card</span>
                            </div>
                        </div>

                        <div class="modal-footer">
                            <button class="btn btn-primary" onclick="viewOrderDetails()">
                                View Order Details
                            </button>
                            <button class="btn btn-outline" onclick="closePaymentModal()">
                                Continue Shopping
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Other Modals (Login, Register, Appointment, etc.) -->
    <div class="modal-overlay" id="login-modal">
        <div class="modal-dialog">
            <div class="modal-header">
                <h2>Login to Your Account</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="login-form">
                    <div class="form-group">
                        <label for="login-email">Email Address</label>
                        <input type="email" id="login-email" name="email" required>
                    </div>
                    <div class="form-group">
                        <label for="login-password">Password</label>
                        <input type="password" id="login-password" name="password" required>
                    </div>
                    <div class="form-group">
                        <button type="submit" class="btn btn-primary" style="width: 100%;">
                            <i class="fas fa-sign-in-alt"></i> Login
                        </button>
                    </div>
                    <div class="form-footer">
                        <p>Don't have an account? <a href="#" id="show-register">Register here</a></p>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="register-modal">
        <div class="modal-dialog">
            <div class="modal-header">
                <h2>Create New Account</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="register-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="register-firstname">First Name</label>
                            <input type="text" id="register-firstname" name="firstname" required>
                        </div>
                        <div class="form-group">
                            <label for="register-lastname">Last Name</label>
                            <input type="text" id="register-lastname" name="lastname" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="register-email">Email Address</label>
                        <input type="email" id="register-email" name="email" required>
                    </div>
                    <div class="form-group">
                        <label for="register-phone">Phone Number</label>
                        <input type="tel" id="register-phone" name="phone">
                    </div>
                    <div class="form-group">
                        <label for="register-address">Address</label>
                        <textarea id="register-address" name="address" rows="2"></textarea>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="register-password">Password</label>
                            <input type="password" id="register-password" name="password" required>
                        </div>
                        <div class="form-group">
                            <label for="register-confirm-password">Confirm Password</label>
                            <input type="password" id="register-confirm-password" name="confirmPassword" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <button type="submit" class="btn btn-primary" style="width: 100%;">
                            <i class="fas fa-user-plus"></i> Create Account
                        </button>
                    </div>
                    <div class="form-footer">
                        <p>Already have an account? <a href="#" id="show-login">Login here</a></p>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Notification System -->
    <div id="notification-container"></div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyB6QmZtUg2qajsUfeii7MBkDmGEbm5JkOE",
            authDomain: "pdsa-database.firebaseapp.com",
            databaseURL: "https://pdsa-database-default-rtdb.firebaseio.com",
            projectId: "pdsa-database",
            storageBucket: "pdsa-database.firebasestorage.app",
            messagingSenderId: "1041468794677",
            appId: "1:1041468794677:web:e7d38f76c644173cf48e7c",
            measurementId: "G-8QLD9BK9M0"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        const storage = firebase.storage();

        // Application State
        const AppState = {
            currentUser: null,
            cart: [],
            userPets: [],
            userAppointments: [],
            userOrders: [],
            isAdmin: false,
            products: [],
            services: [
                { id: 1, name: "General Checkup", price: 250 },
                { id: 2, name: "Vaccination", price: 200 },
                { id: 3, name: "Dental Cleaning", price: 450 },
                { id: 4, name: "Spaying/Neutering", price: 800 },
                { id: 5, name: "Microchipping", price: 350 },
                { id: 6, name: "Grooming Service", price: 250 }
            ],
            selectedPaymentMethod: null,
            currentOrder: null
        };

        // Payment Configuration
        const PaymentConfig = {
            shippingFee: 50,
            freeShippingThreshold: 500,
            taxRate: 0.15 // 15% VAT
        };

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            initApplication();
        });

        // Application Initialization
        function initApplication() {
            initCart();
            setupEventListeners();
            setupModals();
            setupDateRestrictions();
            setupCartIconToProducts();
            
            // Firebase auth state listener
            auth.onAuthStateChanged((user) => {
                if (user) {
                    AppState.currentUser = {
                        uid: user.uid,
                        email: user.email,
                        displayName: user.displayName || user.email.split('@')[0],
                        emailVerified: user.emailVerified
                    };
                    
                    // Check if user is admin
                    checkAdminStatus(user.uid);
                    
                    updateUserUI(AppState.currentUser);
                    loadUserData();
                } else {
                    AppState.currentUser = null;
                    AppState.isAdmin = false;
                    AppState.userPets = [];
                    AppState.userAppointments = [];
                    AppState.userOrders = [];
                }
                updateAuthUI();
            });
            
            // Load products from Firebase
            loadProducts();
            
            showNotification('Welcome to PDSA Veterinary Clinic!', 'info');
        }

        // Fixed Product Loading Function
        async function loadProducts() {
            try {
                console.log('Loading products from Firebase...');
                
                // Show loading state
                showProductsLoading(true);
                
                // FIX: Use a simpler query that doesn't require composite indexes
                const snapshot = await db.collection('products').get();
                
                AppState.products = [];
                
                if (snapshot.empty) {
                    console.log('No products found in database');
                    showProductsEmpty(true);
                    return;
                }
                
                snapshot.forEach(doc => {
                    const product = doc.data();
                    product.id = doc.id;
                    
                    // Only include active products
                    if (product.status !== 'inactive') {
                        AppState.products.push(product);
                    }
                });
                
                console.log(`Loaded ${AppState.products.length} products`);
                renderProducts();
                
            } catch (error) {
                console.error('Error loading products:', error);
                showNotification('Error loading products: ' + error.message, 'error');
                showProductsEmpty(true);
            }
        }

        function showProductsLoading(show) {
            const loadingEl = document.getElementById('products-loading');
            const gridEl = document.getElementById('products-grid');
            const emptyEl = document.getElementById('products-empty');
            
            if (show) {
                loadingEl.style.display = 'block';
                gridEl.style.display = 'none';
                emptyEl.style.display = 'none';
            } else {
                loadingEl.style.display = 'none';
            }
        }

        function showProductsEmpty(show) {
            const loadingEl = document.getElementById('products-loading');
            const gridEl = document.getElementById('products-grid');
            const emptyEl = document.getElementById('products-empty');
            
            if (show) {
                loadingEl.style.display = 'none';
                gridEl.style.display = 'none';
                emptyEl.style.display = 'block';
            } else {
                emptyEl.style.display = 'none';
                gridEl.style.display = 'grid';
            }
        }

        function renderProducts() {
            const productsGrid = document.getElementById('products-grid');
            const productsEmpty = document.getElementById('products-empty');
            
            if (AppState.products.length === 0) {
                productsGrid.innerHTML = '';
                showProductsEmpty(true);
                return;
            }
            
            showProductsLoading(false);
            showProductsEmpty(false);
            
            // Render products grid
            productsGrid.innerHTML = AppState.products.map(product => {
                const stockStatus = getStockStatus(product.stock);
                const stockBadge = product.stock === 0 ? 
                    '<div class="product-badge">Out of Stock</div>' : 
                    product.stock < 10 ? 
                    '<div class="product-badge" style="background-color: var(--warning);">Low Stock</div>' : 
                    '';
                
                return `
                    <div class="product-card" data-category="${product.category || 'all'}">
                        <div class="product-img">
                            <img src="${product.imageUrl || 'https://via.placeholder.com/300x200?text=No+Image'}" 
                                 alt="${product.name}" 
                                 onerror="this.src='https://via.placeholder.com/300x200?text=No+Image'">
                            ${stockBadge}
                        </div>
                        <div class="product-content">
                            <h3>${product.name}</h3>
                            <div class="product-price">R${(product.price || 0).toFixed(2)}</div>
                            <div class="product-rating">
                                ${generateStarRating(product.rating || 4.5)}
                                <span>(${product.rating || 4.5})</span>
                            </div>
                            <p class="product-description">${product.description || 'No description available.'}</p>
                            
                            <div class="stock-status ${stockStatus.class}">
                                <i class="fas ${stockStatus.icon}"></i>
                                ${stockStatus.text}
                            </div>
                            
                            <div class="quantity-control">
                                <button class="quantity-btn" data-action="decrease">-</button>
                                <input type="number" class="quantity-input" value="1" min="1" max="${Math.min(product.stock || 10, 10)}">
                                <button class="quantity-btn" data-action="increase">+</button>
                            </div>
                            
                            <div class="product-actions">
                                <button class="btn btn-primary add-to-cart" 
                                        data-product-id="${product.id}"
                                        data-product-name="${product.name}"
                                        data-product-price="${product.price}"
                                        ${product.stock === 0 ? 'disabled' : ''}>
                                    <i class="fas fa-shopping-cart"></i> 
                                    ${product.stock === 0 ? 'Out of Stock' : 'Add to Cart'}
                                </button>
                                <button class="btn btn-outline wishlist-btn">
                                    <i class="fas fa-heart"></i> Wishlist
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            
            // Add event listeners
            setupProductEventListeners();
            
            // Setup filter functionality
            setupProductFilters();
        }

        function getStockStatus(stock) {
            if (stock === 0) {
                return { class: 'out-of-stock', icon: 'fa-times-circle', text: 'Out of Stock' };
            } else if (stock < 10) {
                return { class: 'low-stock', icon: 'fa-exclamation-triangle', text: `Only ${stock} left` };
            } else {
                return { class: 'in-stock', icon: 'fa-check-circle', text: 'In Stock' };
            }
        }

        function generateStarRating(rating) {
            const fullStars = Math.floor(rating);
            const halfStar = rating % 1 >= 0.5;
            const emptyStars = 5 - fullStars - (halfStar ? 1 : 0);
            
            let stars = '';
            
            // Full stars
            for (let i = 0; i < fullStars; i++) {
                stars += '<i class="fas fa-star"></i>';
            }
            
            // Half star
            if (halfStar) {
                stars += '<i class="fas fa-star-half-alt"></i>';
            }
            
            // Empty stars
            for (let i = 0; i < emptyStars; i++) {
                stars += '<i class="far fa-star"></i>';
            }
            
            return stars;
        }

        function setupProductEventListeners() {
            // Add to cart buttons
            document.querySelectorAll('.add-to-cart').forEach(btn => {
                btn.addEventListener('click', function() {
                    if (!AppState.currentUser) {
                        showNotification('Please log in to add items to cart', 'warning');
                        showModal('login-modal');
                        return;
                    }
                    
                    const productId = this.getAttribute('data-product-id');
                    const productName = this.getAttribute('data-product-name');
                    const productPrice = parseFloat(this.getAttribute('data-product-price'));
                    const productCard = this.closest('.product-card');
                    const productImage = productCard.querySelector('.product-img img').src;
                    const quantityInput = productCard.querySelector('.quantity-input');
                    const quantity = quantityInput ? parseInt(quantityInput.value) || 1 : 1;
                    
                    addToCart(productId, productName, productPrice, productImage, quantity);
                    
                    // Reset quantity
                    if (quantityInput) quantityInput.value = 1;
                });
            });
            
            // Quantity buttons
            document.querySelectorAll('.quantity-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const action = this.getAttribute('data-action');
                    const input = this.parentElement.querySelector('.quantity-input');
                    if (!input) return;
                    
                    let value = parseInt(input.value) || 1;
                    const max = parseInt(input.max) || 10;
                    
                    if (action === 'increase' && value < max) {
                        input.value = value + 1;
                    } else if (action === 'decrease' && value > 1) {
                        input.value = value - 1;
                    }
                });
            });
            
            // Wishlist buttons
            document.querySelectorAll('.wishlist-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    if (!AppState.currentUser) {
                        showNotification('Please log in to add items to wishlist', 'warning');
                        showModal('login-modal');
                        return;
                    }
                    showNotification('Added to wishlist!', 'success');
                });
            });
        }

        function setupProductFilters() {
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const filter = this.getAttribute('data-filter');
                    
                    // Update active button
                    document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Filter products
                    document.querySelectorAll('.product-card').forEach(card => {
                        const category = card.getAttribute('data-category');
                        
                        if (filter === 'all' || category === filter) {
                            card.style.display = 'block';
                        } else {
                            card.style.display = 'none';
                        }
                    });
                });
            });
        }

        // Cart Management
        function initCart() {
            const savedCart = localStorage.getItem('pdsaCart');
            if (savedCart) {
                try {
                    AppState.cart = JSON.parse(savedCart);
                    updateCartUI();
                } catch (error) {
                    console.error('Error parsing saved cart:', error);
                    AppState.cart = [];
                    localStorage.removeItem('pdsaCart');
                }
            }
        }

        function updateCartUI() {
            try {
                const cartCountElement = document.querySelector('.cart-count');
                if (cartCountElement) {
                    const totalItems = AppState.cart.reduce((total, item) => total + (item.quantity || 1), 0);
                    cartCountElement.textContent = totalItems;
                }
                
                const cartItems = document.getElementById('cart-items');
                if (!cartItems) return;
                
                cartItems.innerHTML = '';
                
                if (AppState.cart.length === 0) {
                    const emptyCartMessage = document.getElementById('empty-cart-message');
                    if (emptyCartMessage) {
                        emptyCartMessage.style.display = 'block';
                    }
                    if (document.getElementById('checkout-btn')) {
                        document.getElementById('checkout-btn').disabled = true;
                    }
                } else {
                    const emptyCartMessage = document.getElementById('empty-cart-message');
                    if (emptyCartMessage) {
                        emptyCartMessage.style.display = 'none';
                    }
                    if (document.getElementById('checkout-btn')) {
                        document.getElementById('checkout-btn').disabled = false;
                    }
                    
                    AppState.cart.forEach(item => {
                        const cartItem = document.createElement('div');
                        cartItem.className = 'cart-item';
                        cartItem.innerHTML = `
                            <div class="cart-item-img">
                                <img src="${item.image || 'https://via.placeholder.com/80'}" alt="${item.name}" onerror="this.src='https://via.placeholder.com/80'">
                            </div>
                            <div class="cart-item-details">
                                <h4>${item.name || 'Unknown Product'}</h4>
                                <div class="cart-item-price">R${parseFloat(item.price || 0).toFixed(2)}</div>
                                <div class="cart-item-quantity">
                                    <button class="quantity-btn" data-action="decrease" data-id="${item.id}">-</button>
                                    <span>${item.quantity || 1}</span>
                                    <button class="quantity-btn" data-action="increase" data-id="${item.id}">+</button>
                                </div>
                            </div>
                            <button class="cart-item-remove" data-id="${item.id}">
                                <i class="fas fa-trash"></i>
                            </button>
                        `;
                        cartItems.appendChild(cartItem);
                    });
                }
                
                const cartTotalElement = document.getElementById('cart-total-amount');
                if (cartTotalElement) {
                    const total = AppState.cart.reduce((sum, item) => {
                        const price = parseFloat(item.price || 0);
                        const quantity = item.quantity || 1;
                        return sum + (price * quantity);
                    }, 0);
                    cartTotalElement.textContent = `R${total.toFixed(2)}`;
                }
                
                // Add event listeners to cart buttons
                setTimeout(() => {
                    document.querySelectorAll('.cart-item-remove').forEach(btn => {
                        btn.onclick = function() {
                            const productId = this.getAttribute('data-id');
                            removeFromCart(productId);
                        };
                    });
                    
                    document.querySelectorAll('.cart-item .quantity-btn').forEach(btn => {
                        btn.onclick = function() {
                            const action = this.getAttribute('data-action');
                            const productId = this.getAttribute('data-id');
                            updateCartQuantity(productId, action);
                        };
                    });
                }, 100);
                
                saveCart();
            } catch (error) {
                console.error('Error updating cart UI:', error);
            }
        }

        function addToCart(productId, productName, productPrice, productImage, quantity = 1) {
            // Validate inputs
            if (!productId || !productName) {
                console.error('Invalid product data');
                return;
            }
            
            const price = parseFloat(productPrice) || 0;
            const qty = parseInt(quantity) || 1;
            
            const existingItem = AppState.cart.find(item => item.id === productId);
            
            if (existingItem) {
                // Check if we exceed available stock
                const product = AppState.products.find(p => p.id === productId);
                if (product && (existingItem.quantity + qty) > product.stock) {
                    showNotification(`Only ${product.stock} items available in stock`, 'warning');
                    return;
                }
                existingItem.quantity += qty;
            } else {
                AppState.cart.push({
                    id: productId,
                    name: productName,
                    price: price,
                    image: productImage,
                    quantity: qty
                });
            }
            
            updateCartUI();
            showNotification(`${qty} x ${productName} added to cart!`, 'success');
        }

        function removeFromCart(productId) {
            AppState.cart = AppState.cart.filter(item => item.id !== productId);
            updateCartUI();
            showNotification('Item removed from cart', 'info');
        }

        function updateCartQuantity(productId, action) {
            const item = AppState.cart.find(item => item.id === productId);
            
            if (item) {
                const product = AppState.products.find(p => p.id === productId);
                
                if (action === 'increase') {
                    if (product && (item.quantity + 1) > product.stock) {
                        showNotification(`Only ${product.stock} items available in stock`, 'warning');
                        return;
                    }
                    item.quantity = (item.quantity || 1) + 1;
                } else if (action === 'decrease' && (item.quantity || 1) > 1) {
                    item.quantity = (item.quantity || 1) - 1;
                }
                
                updateCartUI();
            }
        }

        function saveCart() {
            try {
                localStorage.setItem('pdsaCart', JSON.stringify(AppState.cart));
            } catch (error) {
                console.error('Error saving cart to localStorage:', error);
            }
        }

        // Enhanced Payment Functions
        function openPaymentModal() {
            if (!AppState.currentUser) {
                showNotification('Please log in to proceed with payment', 'warning');
                showModal('login-modal');
                return;
            }
            
            if (AppState.cart.length === 0) {
                showNotification('Your cart is empty', 'warning');
                return;
            }
            
            // Validate stock before payment
            if (!validateCartStock()) {
                return;
            }
            
            updatePaymentSummary();
            showModal('payment-modal');
            resetPaymentUI();
        }

        function updatePaymentSummary() {
            const subtotal = calculateSubtotal();
            const shipping = calculateShipping(subtotal);
            const tax = calculateTax(subtotal);
            const total = subtotal + shipping + tax;
            
            // Update summary display
            document.getElementById('payment-subtotal').textContent = `R${subtotal.toFixed(2)}`;
            document.getElementById('payment-shipping').textContent = `R${shipping.toFixed(2)}`;
            document.getElementById('payment-tax').textContent = `R${tax.toFixed(2)}`;
            document.getElementById('payment-total').textContent = `R${total.toFixed(2)}`;
            
            // Update order items
            const orderItemsContainer = document.getElementById('payment-order-items');
            orderItemsContainer.innerHTML = AppState.cart.map(item => `
                <div class="summary-item">
                    <span>${item.name} x${item.quantity}</span>
                    <span>R${(item.price * item.quantity).toFixed(2)}</span>
                </div>
            `).join('');
            
            // Store order details for later use
            AppState.currentOrder = {
                subtotal,
                shipping,
                tax,
                total,
                items: AppState.cart.map(item => ({
                    id: item.id,
                    name: item.name,
                    price: item.price,
                    quantity: item.quantity,
                    image: item.image
                }))
            };
        }

        function calculateSubtotal() {
            return AppState.cart.reduce((sum, item) => {
                return sum + (parseFloat(item.price) * (item.quantity || 1));
            }, 0);
        }

        function calculateShipping(subtotal) {
            return subtotal >= PaymentConfig.freeShippingThreshold ? 0 : PaymentConfig.shippingFee;
        }

        function calculateTax(subtotal) {
            return subtotal * PaymentConfig.taxRate;
        }

        function selectPaymentMethod(method) {
            AppState.selectedPaymentMethod = method;
            
            // Update UI
            document.querySelectorAll('.payment-method').forEach(el => {
                el.classList.remove('selected');
            });
            document.querySelector(`.payment-method[data-method="${method}"]`).classList.add('selected');
            
            // Enable proceed button
            document.getElementById('proceed-to-payment').disabled = false;
        }

        function proceedToPayment() {
            if (!AppState.selectedPaymentMethod) {
                showNotification('Please select a payment method', 'error');
                return;
            }
            
            // Hide step 1, show step 2
            document.getElementById('payment-step-1').style.display = 'none';
            document.getElementById('payment-step-2').style.display = 'block';
            
            // Show selected payment form
            document.querySelectorAll('.payment-form-section').forEach(form => {
                form.classList.remove('active');
            });
            document.getElementById(`${AppState.selectedPaymentMethod}-payment-form`).classList.add('active');
            
            // Update EFT reference
            if (AppState.selectedPaymentMethod === 'eft') {
                document.getElementById('eft-reference').textContent = `ORD-${Date.now()}`;
            }
            
            // Update cash amount
            if (AppState.selectedPaymentMethod === 'cash') {
                document.getElementById('cash-amount').textContent = `R${AppState.currentOrder.total.toFixed(2)}`;
            }
        }

        function backToPaymentMethods() {
            document.getElementById('payment-step-2').style.display = 'none';
            document.getElementById('payment-step-1').style.display = 'block';
        }

        function closePaymentModal() {
            hideModal('payment-modal');
            resetPaymentUI();
        }

        function resetPaymentUI() {
            AppState.selectedPaymentMethod = null;
            document.getElementById('payment-step-1').style.display = 'block';
            document.getElementById('payment-step-2').style.display = 'none';
            document.getElementById('payment-processing').style.display = 'none';
            document.getElementById('order-success').style.display = 'none';
            
            document.querySelectorAll('.payment-method').forEach(el => {
                el.classList.remove('selected');
            });
            document.getElementById('proceed-to-payment').disabled = true;
        }

        // Enhanced Payment Processing
        async function processCardPayment() {
            // In a real implementation, you would integrate with Stripe or another payment processor
            // For now, we'll simulate the payment process
            
            const payButton = document.getElementById('pay-now-btn');
            const originalText = payButton.innerHTML;
            
            try {
                // Show processing state
                payButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';
                payButton.disabled = true;
                
                // Simulate API call to payment processor
                await simulatePaymentAPI();
                
                // If successful, complete the order
                await completeOrder('card', 'paid');
                
            } catch (error) {
                console.error('Payment processing error:', error);
                showNotification('Payment failed: ' + error.message, 'error');
                
                // Reset button
                payButton.innerHTML = originalText;
                payButton.disabled = false;
            }
        }

        function confirmEFTPayment() {
            showNotification('Please complete your bank transfer using the provided details. Your order will be processed once payment is confirmed.', 'info');
            completeOrder('eft', 'pending');
        }

        function confirmCashPayment() {
            completeOrder('cash', 'pending');
        }

        async function completeOrder(paymentMethod, paymentStatus) {
            try {
                // Show processing screen
                document.getElementById('payment-step-2').style.display = 'none';
                document.getElementById('payment-processing').style.display = 'block';
                
                const orderId = 'ORD-' + Date.now();
                const orderData = {
                    id: orderId,
                    userId: AppState.currentUser.uid,
                    userEmail: AppState.currentUser.email,
                    userName: AppState.currentUser.displayName,
                    items: AppState.currentOrder.items,
                    subtotal: AppState.currentOrder.subtotal,
                    shipping: AppState.currentOrder.shipping,
                    tax: AppState.currentOrder.tax,
                    total: AppState.currentOrder.total,
                    status: 'confirmed',
                    paymentMethod: paymentMethod,
                    paymentStatus: paymentStatus,
                    billingAddress: document.getElementById('billing-address').value || '',
                    date: new Date().toISOString(),
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                };
                
                // Update product stock and save order in a batch
                const batch = db.batch();
                
                // Add order to batch
                const orderRef = db.collection('orders').doc();
                batch.set(orderRef, orderData);
                
                // Update product stock for each item
                for (const cartItem of AppState.cart) {
                    const product = AppState.products.find(p => p.id === cartItem.id);
                    if (product) {
                        const productRef = db.collection('products').doc(cartItem.id);
                        batch.update(productRef, {
                            stock: firebase.firestore.FieldValue.increment(-cartItem.quantity),
                            updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                        });
                    }
                }
                
                // Commit the batch
                await batch.commit();
                
                orderData.firebaseId = orderRef.id;
                AppState.userOrders.unshift(orderData);
                
                // Clear cart
                AppState.cart = [];
                saveCart();
                updateCartUI();
                
                // Show success screen
                showOrderSuccess(orderData);
                
            } catch (error) {
                console.error('Error completing order:', error);
                showNotification('Error completing order: ' + error.message, 'error');
                
                // Return to payment methods
                document.getElementById('payment-processing').style.display = 'none';
                document.getElementById('payment-step-2').style.display = 'block';
            }
        }

        function showOrderSuccess(order) {
            document.getElementById('payment-processing').style.display = 'none';
            document.getElementById('order-success').style.display = 'block';
            
            // Update success details
            document.getElementById('success-order-number').textContent = order.id;
            document.getElementById('success-order-total').textContent = `R${order.total.toFixed(2)}`;
            document.getElementById('success-payment-method').textContent = 
                order.paymentMethod.charAt(0).toUpperCase() + order.paymentMethod.slice(1);
        }

        function viewOrderDetails() {
            closePaymentModal();
            showOrderTracking(order.firebaseId);
        }

        // Utility Functions
        function simulatePaymentAPI() {
            return new Promise((resolve, reject) => {
                // Simulate API call delay
                setTimeout(() => {
                    // Simulate 95% success rate
                    if (Math.random() > 0.05) {
                        resolve({ success: true, transactionId: 'TXN_' + Date.now() });
                    } else {
                        reject(new Error('Payment declined by bank'));
                    }
                }, 2000);
            });
        }

        function validateCartStock() {
            for (const cartItem of AppState.cart) {
                const product = AppState.products.find(p => p.id === cartItem.id);
                if (!product) {
                    showNotification(`Product "${cartItem.name}" is no longer available`, 'error');
                    return false;
                }
                if (product.stock < cartItem.quantity) {
                    showNotification(`Only ${product.stock} items available for "${cartItem.name}"`, 'error');
                    return false;
                }
            }
            return true;
        }

        // Cart Modal Functions
        function openCart() {
            const cartContainer = document.getElementById('cart-container');
            const cartOverlay = document.getElementById('cart-overlay');
            if (cartContainer) cartContainer.classList.add('open');
            if (cartOverlay) cartOverlay.classList.add('open');
        }

        function closeCart() {
            const cartContainer = document.getElementById('cart-container');
            const cartOverlay = document.getElementById('cart-overlay');
            if (cartContainer) cartContainer.classList.remove('open');
            if (cartOverlay) cartOverlay.classList.remove('open');
        }

        // Authentication Management
        function updateAuthUI() {
            const loginBtn = document.getElementById('login-btn');
            const registerBtn = document.getElementById('register-btn');
            const userMenu = document.getElementById('user-menu');
            const authOverlays = document.querySelectorAll('.auth-overlay');
            const bookAppointmentBtn = document.getElementById('book-appointment-btn');
            const productCards = document.querySelectorAll('.product-card.auth-required');
            
            if (AppState.currentUser) {
                // User is logged in
                if (loginBtn) loginBtn.style.display = 'none';
                if (registerBtn) registerBtn.style.display = 'none';
                if (userMenu) userMenu.style.display = 'block';
                
                // Hide auth overlays on products
                authOverlays.forEach(overlay => {
                    if (overlay) overlay.style.display = 'none';
                });
                
                // Enable product interactions
                productCards.forEach(card => {
                    card.classList.remove('auth-required');
                });
                
                if (AppState.cart.length > 0 && document.getElementById('checkout-btn')) {
                    document.getElementById('checkout-btn').disabled = false;
                }
                
                // Enable appointment booking
                if (bookAppointmentBtn) {
                    bookAppointmentBtn.onclick = function() {
                        showModal('appointment-modal');
                    };
                }
                
                // Enable add to cart buttons
                document.querySelectorAll('.add-to-cart').forEach(btn => {
                    btn.disabled = false;
                    btn.style.opacity = '1';
                });
                
            } else {
                // User is not logged in
                if (loginBtn) loginBtn.style.display = 'inline-flex';
                if (registerBtn) registerBtn.style.display = 'inline-flex';
                if (userMenu) userMenu.style.display = 'none';
                
                // Show auth overlays on products
                authOverlays.forEach(overlay => {
                    if (overlay) overlay.style.display = 'flex';
                });
                
                // Disable product interactions
                productCards.forEach(card => {
                    card.classList.add('auth-required');
                });
                
                if (document.getElementById('checkout-btn')) {
                    document.getElementById('checkout-btn').disabled = true;
                }
                
                // Redirect to login for appointments
                if (bookAppointmentBtn) {
                    bookAppointmentBtn.onclick = function(e) {
                        e.preventDefault();
                        showModal('login-modal');
                    };
                }
                
                // Disable add to cart buttons
                document.querySelectorAll('.add-to-cart').forEach(btn => {
                    btn.disabled = true;
                    btn.style.opacity = '0.6';
                });
            }
        }

        // Firebase Authentication
        function login(email, password) {
            if (!email || !password) {
                showNotification('Please enter email and password', 'error');
                return;
            }
            
            showNotification('Logging in...', 'info');
            
            auth.signInWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    const user = userCredential.user;
                    AppState.currentUser = {
                        uid: user.uid,
                        email: user.email,
                        displayName: user.displayName || user.email.split('@')[0],
                        emailVerified: user.emailVerified
                    };
                    
                    updateUserUI(AppState.currentUser);
                    updateAuthUI();
                    loadUserData();
                    
                    showNotification('Login successful!', 'success');
                    hideModal('login-modal');
                })
                .catch((error) => {
                    console.error('Login error:', error);
                    let errorMessage = 'Login failed';
                    switch (error.code) {
                        case 'auth/invalid-email':
                            errorMessage = 'Invalid email address';
                            break;
                        case 'auth/user-disabled':
                            errorMessage = 'This account has been disabled';
                            break;
                        case 'auth/user-not-found':
                            errorMessage = 'No account found with this email';
                            break;
                        case 'auth/wrong-password':
                            errorMessage = 'Incorrect password';
                            break;
                        default:
                            errorMessage = error.message;
                    }
                    showNotification(errorMessage, 'error');
                });
        }

        function register(userData) {
            if (!userData.email || !userData.password) {
                showNotification('Please fill in all required fields', 'error');
                return;
            }
            
            if (userData.password !== userData.confirmPassword) {
                showNotification('Passwords do not match', 'error');
                return;
            }
            
            showNotification('Creating account...', 'info');
            
            auth.createUserWithEmailAndPassword(userData.email, userData.password)
                .then((userCredential) => {
                    const user = userCredential.user;
                    
                    // Save additional user data to Firestore
                    return db.collection('users').doc(user.uid).set({
                        firstName: userData.firstname || '',
                        lastName: userData.lastname || '',
                        email: userData.email,
                        phone: userData.phone || '',
                        address: userData.address || '',
                        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                    }).then(() => {
                        AppState.currentUser = {
                            uid: user.uid,
                            email: user.email,
                            displayName: `${userData.firstname || ''} ${userData.lastname || ''}`.trim() || user.email.split('@')[0],
                            emailVerified: false
                        };
                        
                        updateUserUI(AppState.currentUser);
                        updateAuthUI();
                        
                        showNotification('Registration successful! Welcome to PDSA Veterinary Clinic.', 'success');
                        hideModal('register-modal');
                    });
                })
                .catch((error) => {
                    console.error('Registration error:', error);
                    let errorMessage = 'Registration failed';
                    switch (error.code) {
                        case 'auth/email-already-in-use':
                            errorMessage = 'Email already in use';
                            break;
                        case 'auth/invalid-email':
                            errorMessage = 'Invalid email address';
                            break;
                        case 'auth/weak-password':
                            errorMessage = 'Password is too weak';
                            break;
                        default:
                            errorMessage = error.message;
                    }
                    showNotification(errorMessage, 'error');
                });
        }

        function logout() {
            auth.signOut()
                .then(() => {
                    AppState.currentUser = null;
                    AppState.isAdmin = false;
                    AppState.userPets = [];
                    AppState.userAppointments = [];
                    AppState.userOrders = [];
                    updateCartUI();
                    showNotification('Logged out successfully', 'info');
                    updateAuthUI();
                })
                .catch((error) => {
                    console.error('Logout error:', error);
                    showNotification('Error logging out: ' + error.message, 'error');
                });
        }

        function updateUserUI(userData) {
            const userName = document.getElementById('user-name');
            if (userData && userName) {
                userName.textContent = userData.displayName || userData.email;
            }
        }

        function checkAdminStatus(uid) {
            if (!uid) return;
            
            db.collection('admins').doc(uid).get()
                .then((doc) => {
                    if (doc.exists) {
                        AppState.isAdmin = true;
                        const adminPanel = document.getElementById('admin-panel');
                        const adminLink = document.getElementById('admin-link');
                        if (adminPanel) adminPanel.style.display = 'block';
                        if (adminLink) adminLink.style.display = 'inline-flex';
                    }
                })
                .catch((error) => {
                    console.error('Error checking admin status:', error);
                });
        }

        // Event Listeners Setup
        function setupEventListeners() {
            setupAuthEventListeners();
            setupCartEventListeners();
            setupProductEventListeners();
            setupFAQ();
            setupNavScroll();
            setupContactForm();
            setupModals();
        }

        function setupAuthEventListeners() {
            // Login form
            const loginForm = document.getElementById('login-form');
            if (loginForm) {
                loginForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    const formData = new FormData(this);
                    login(formData.get('email'), formData.get('password'));
                });
            }
            
            // Register form
            const registerForm = document.getElementById('register-form');
            if (registerForm) {
                registerForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    const formData = new FormData(this);
                    register({
                        firstname: formData.get('firstname'),
                        lastname: formData.get('lastname'),
                        email: formData.get('email'),
                        password: formData.get('password'),
                        confirmPassword: formData.get('confirmPassword'),
                        phone: formData.get('phone'),
                        address: formData.get('address')
                    });
                });
            }
            
            // Logout
            const logoutLink = document.getElementById('logout-link');
            if (logoutLink) {
                logoutLink.addEventListener('click', function(e) {
                    e.preventDefault();
                    logout();
                });
            }
            
            // Login and Register buttons
            const loginBtn = document.getElementById('login-btn');
            const registerBtn = document.getElementById('register-btn');
            
            if (loginBtn) {
                loginBtn.addEventListener('click', function() {
                    showModal('login-modal');
                });
            }
            
            if (registerBtn) {
                registerBtn.addEventListener('click', function() {
                    showModal('register-modal');
                });
            }
        }

        function setupCartEventListeners() {
            // Cart toggle
            const cartBtn = document.getElementById('cart-btn');
            const closeCartBtn = document.getElementById('close-cart');
            const continueShoppingBtn = document.getElementById('continue-shopping');
            const checkoutBtn = document.getElementById('checkout-btn');
            
            if (cartBtn) {
                cartBtn.addEventListener('click', openCart);
            }
            
            if (closeCartBtn) {
                closeCartBtn.addEventListener('click', closeCart);
            }
            
            const cartOverlay = document.getElementById('cart-overlay');
            if (cartOverlay) {
                cartOverlay.addEventListener('click', closeCart);
            }
            
            if (continueShoppingBtn) {
                continueShoppingBtn.addEventListener('click', function() {
                    closeCart();
                    const productsSection = document.getElementById('products');
                    if (productsSection) {
                        productsSection.scrollIntoView({ 
                            behavior: 'smooth',
                            block: 'start'
                        });
                    }
                });
            }
            
            if (checkoutBtn) {
                checkoutBtn.addEventListener('click', openPaymentModal);
            }
        }

        function setupCartIconToProducts() {
            const cartBtn = document.getElementById('cart-btn');
            
            if (cartBtn) {
                cartBtn.addEventListener('click', function(e) {
                    // If cart is empty, scroll to products
                    if (AppState.cart.length === 0) {
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // Close cart if it's open
                        closeCart();
                        
                        // Show notification
                        showNotification('Your cart is empty! Taking you to our products.', 'info');
                        
                        // Scroll to products section smoothly
                        const productsSection = document.getElementById('products');
                        if (productsSection) {
                            productsSection.scrollIntoView({ 
                                behavior: 'smooth',
                                block: 'start'
                            });
                            
                            // Update navigation highlight
                            document.querySelectorAll('nav a').forEach(link => {
                                link.classList.remove('active');
                                if (link.getAttribute('href') === '#products') {
                                    link.classList.add('active');
                                }
                            });
                        }
                    } else {
                        // If cart has items, open cart normally
                        openCart();
                    }
                });
            }
        }

        function setupContactForm() {
            const contactForm = document.getElementById('contact-form');
            if (!contactForm) return;
            
            contactForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const formData = new FormData(this);
                const contactData = {
                    name: formData.get('name') || '',
                    email: formData.get('email') || '',
                    phone: formData.get('phone') || '',
                    subject: formData.get('subject') || 'general',
                    message: formData.get('message') || '',
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    status: 'new'
                };
                
                // Validate required fields
                if (!contactData.name || !contactData.email || !contactData.message) {
                    showNotification('Please fill in all required fields', 'error');
                    return;
                }
                
                showNotification('Sending your message...', 'info');
                
                // Save to Firestore
                db.collection('contactMessages').add(contactData)
                    .then((docRef) => {
                        showNotification('Your message has been sent successfully! We will get back to you soon.', 'success');
                        contactForm.reset();
                    })
                    .catch((error) => {
                        console.error('Error sending message:', error);
                        showNotification('Error sending message. Please try again.', 'error');
                    });
            });
        }

        function setupModals() {
            // Login/Register modal toggles
            const showRegister = document.getElementById('show-register');
            const showLogin = document.getElementById('show-login');
            
            if (showRegister) {
                showRegister.addEventListener('click', function(e) {
                    e.preventDefault();
                    hideModal('login-modal');
                    showModal('register-modal');
                });
            }
            
            if (showLogin) {
                showLogin.addEventListener('click', function(e) {
                    e.preventDefault();
                    hideModal('register-modal');
                    showModal('login-modal');
                });
            }
            
            // Modal close buttons
            document.querySelectorAll('.close-modal').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.modal-overlay').forEach(modal => {
                        modal.classList.remove('active');
                    });
                });
            });
            
            // Close modals when clicking outside
            window.addEventListener('click', (e) => {
                if (e.target.classList.contains('modal-overlay')) {
                    document.querySelectorAll('.modal-overlay').forEach(modal => {
                        modal.classList.remove('active');
                    });
                }
            });
        }

        function setupFAQ() {
            document.querySelectorAll('.faq-question').forEach(question => {
                question.addEventListener('click', () => {
                    const item = question.parentElement;
                    item.classList.toggle('active');
                });
            });
        }

        function setupNavScroll() {
            window.addEventListener('scroll', () => {
                const scrollPosition = window.scrollY;
                
                document.querySelectorAll('section').forEach(section => {
                    const sectionTop = section.offsetTop - 100;
                    const sectionBottom = sectionTop + section.offsetHeight;
                    const sectionId = section.getAttribute('id');
                    
                    if (scrollPosition >= sectionTop && scrollPosition < sectionBottom) {
                        document.querySelectorAll('nav a').forEach(link => {
                            link.classList.remove('active');
                            if (link.getAttribute('href') === `#${sectionId}`) {
                                link.classList.add('active');
                            }
                        });
                    }
                });
            });

            document.querySelectorAll('nav a').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const targetId = link.getAttribute('href');
                    const targetSection = document.querySelector(targetId);
                    
                    if (targetSection) {
                        window.scrollTo({
                            top: targetSection.offsetTop - 80,
                            behavior: 'smooth'
                        });
                        
                        document.querySelectorAll('nav a').forEach(navLink => navLink.classList.remove('active'));
                        link.classList.add('active');
                    }
                });
            });
        }

        function setupDateRestrictions() {
            const dateInput = document.getElementById('appointment-date');
            if (dateInput) {
                const today = new Date().toISOString().split('T')[0];
                dateInput.min = today;
            }
        }

        // Utility Functions
        function showModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.add('active');
            }
        }

        function hideModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.remove('active');
            }
        }

        // Enhanced Notification System
        function showNotification(message, type) {
            // Create notification container if it doesn't exist
            let container = document.getElementById('notification-container');
            if (!container) {
                container = document.createElement('div');
                container.id = 'notification-container';
                container.style.cssText = 'position: fixed; top: 20px; right: 20px; z-index: 10000;';
                document.body.appendChild(container);
            }
            
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <span>${message}</span>
                <button class="close-notification">&times;</button>
            `;
            
            container.appendChild(notification);
            
            // Show notification
            setTimeout(() => {
                notification.classList.add('show');
            }, 100);
            
            // Auto remove after 5 seconds
            const autoRemove = setTimeout(() => {
                closeNotification(notification);
            }, 5000);
            
            // Close button event
            const closeBtn = notification.querySelector('.close-notification');
            if (closeBtn) {
                closeBtn.addEventListener('click', () => {
                    clearTimeout(autoRemove);
                    closeNotification(notification);
                });
            }
            
            function closeNotification(notif) {
                notif.classList.remove('show');
                setTimeout(() => {
                    if (notif.parentNode) {
                        notif.parentNode.removeChild(notif);
                    }
                }, 300);
            }
        }

        // Sample Products Initialization
        async function initializeSampleProducts() {
            try {
                showNotification('Adding sample products...', 'info');
                
                const sampleProducts = [
                    {
                        name: "Premium Dog Food",
                        description: "High-quality dog food with all essential nutrients for your furry friend.",
                        price: 299.99,
                        category: "food",
                        stock: 25,
                        rating: 4.8,
                        imageUrl: "https://images.unsplash.com/photo-1568640347023-a616a30bc3bd?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1470&q=80",
                        status: "active",
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    },
                    {
                        name: "Cat Toy Set",
                        description: "Interactive toy set to keep your cat entertained and active.",
                        price: 149.99,
                        category: "toys",
                        stock: 8,
                        rating: 4.5,
                        imageUrl: "https://images.unsplash.com/photo-1592194996308-7b43878c84c1?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=687&q=80",
                        status: "active",
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    },
                    {
                        name: "Pet Grooming Kit",
                        description: "Complete grooming kit for all your pet's hygiene needs.",
                        price: 399.99,
                        category: "grooming",
                        stock: 15,
                        rating: 4.7,
                        imageUrl: "https://images.unsplash.com/photo-1516734212186-a967f81ad0d7?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1471&q=80",
                        status: "active",
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    }
                ];
                
                // Add products to Firestore
                const batch = db.batch();
                sampleProducts.forEach(product => {
                    const docRef = db.collection('products').doc();
                    batch.set(docRef, product);
                });
                
                await batch.commit();
                showNotification('Sample products added successfully!', 'success');
                
                // Reload products
                await loadProducts();
                
            } catch (error) {
                console.error('Error adding sample products:', error);
                showNotification('Error adding sample products: ' + error.message, 'error');
            }
        }

        // User Dashboard Functions (placeholder)
        function loadUserData() {
            // Placeholder for user data loading
        }

        function showOrderTracking(orderId) {
            // Placeholder for order tracking
            showNotification('Order tracking would open here', 'info');
        }

        // Make functions globally available
        window.showModal = showModal;
        window.hideModal = hideModal;
        window.openPaymentModal = openPaymentModal;
        window.selectPaymentMethod = selectPaymentMethod;
        window.proceedToPayment = proceedToPayment;
        window.backToPaymentMethods = backToPaymentMethods;
        window.closePaymentModal = closePaymentModal;
        window.processCardPayment = processCardPayment;
        window.confirmEFTPayment = confirmEFTPayment;
        window.confirmCashPayment = confirmCashPayment;
        window.viewOrderDetails = viewOrderDetails;
        window.initializeSampleProducts = initializeSampleProducts;

        // Add event listener for initialize products button
        const initializeBtn = document.getElementById('initialize-products-btn');
        if (initializeBtn) {
            initializeBtn.addEventListener('click', initializeSampleProducts);
        }

        // Hero buttons
        const learnMoreBtn = document.getElementById('learn-more-btn');
        if (learnMoreBtn) {
            learnMoreBtn.addEventListener('click', () => {
                const aboutSection = document.getElementById('about');
                if (aboutSection) {
                    aboutSection.scrollIntoView({ behavior: 'smooth' });
                }
            });
        }

        // Emergency button functionality
        const emergencyBanner = document.getElementById('emergency-banner');
        if (emergencyBanner) {
            emergencyBanner.addEventListener('click', (e) => {
                // Emergency button functionality
            });
        }

        // Appointment Management Functions
function setupAppointmentBooking() {
    // Initialize appointment modal
    initAppointmentModal();
    
    // Setup appointment form event listeners
    setupAppointmentForm();
    
    // Setup pet management
    setupPetManagement();
}

function initAppointmentModal() {
    // Create appointment modal if it doesn't exist
    if (!document.getElementById('appointment-modal')) {
        const appointmentModal = document.createElement('div');
        appointmentModal.id = 'appointment-modal';
        appointmentModal.className = 'modal-overlay';
        appointmentModal.innerHTML = `
            <div class="modal-dialog appointment-modal">
                <div class="modal-header">
                    <h2>Book an Appointment</h2>
                    <button class="close-modal">&times;</button>
                </div>
                <div class="modal-body">
                    <div id="appointment-step-1">
                        <form id="appointment-form">
                            <div class="form-group">
                                <label for="appointment-service">Service *</label>
                                <select id="appointment-service" name="service" required>
                                    <option value="">Choose a service...</option>
                                    <option value="general-checkup" data-price="250">General Checkup - R250</option>
                                    <option value="vaccination" data-price="200">Vaccination - R200</option>
                                    <option value="dental-cleaning" data-price="450">Dental Cleaning - R450</option>
                                    <option value="surgery" data-price="800">Surgical Procedure - From R800</option>
                                    <option value="microchipping" data-price="350">Microchipping - R350</option>
                                    <option value="grooming" data-price="250">Professional Grooming - R250</option>
                                    <option value="nutrition" data-price="300">Nutrition Counseling - R300</option>
                                    <option value="emergency" data-price="500">Emergency Consultation - R500</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="appointment-pet">Select Pet *</label>
                                <select id="appointment-pet" name="pet" required>
                                    <option value="">Select a pet...</option>
                                </select>
                                <div class="no-pets-message" style="display: none; background: #fff3cd; padding: 1rem; border-radius: 4px; margin-top: 0.5rem;">
                                    <p>No pets registered. Please add a pet first.</p>
                                    <button type="button" class="btn btn-primary" id="add-pet-btn">
                                        <i class="fas fa-plus"></i> Add New Pet
                                    </button>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="appointment-date">Date *</label>
                                    <input type="date" id="appointment-date" name="date" required>
                                </div>
                                <div class="form-group">
                                    <label>Time Slot *</label>
                                    <div class="time-slots" id="time-slots">
                                        <!-- Time slots will be generated here -->
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="appointment-notes">Additional Notes (Optional)</label>
                                <textarea id="appointment-notes" name="notes" rows="3" placeholder="Any specific concerns or requirements..."></textarea>
                            </div>
                            
                            <div id="appointment-summary" class="appointment-summary">
                                <!-- Appointment summary will be displayed here -->
                            </div>
                            
                            <div class="modal-footer">
                                <button type="button" class="btn btn-outline" onclick="closeAppointmentModal()">Cancel</button>
                                <button type="submit" class="btn btn-primary" id="book-appointment-btn-final" disabled>
                                    <i class="fas fa-calendar-check"></i> Book Appointment
                                </button>
                            </div>
                        </form>
                    </div>
                    
                    <div id="appointment-processing" style="display: none;">
                        <div class="payment-processing">
                            <i class="fas fa-spinner fa-spin"></i>
                            <h3>Booking Your Appointment</h3>
                            <p>Please wait while we confirm your appointment...</p>
                        </div>
                    </div>
                    
                    <div id="appointment-success" style="display: none;">
                        <div class="order-success">
                            <i class="fas fa-check-circle"></i>
                            <h3>Appointment Booked Successfully!</h3>
                            <p>Your appointment has been confirmed. We look forward to seeing you and your pet.</p>
                            
                            <div class="order-details">
                                <h4>Appointment Details</h4>
                                <div class="order-detail-item">
                                    <span>Appointment ID:</span>
                                    <span id="success-appointment-number">APT-123456</span>
                                </div>
                                <div class="order-detail-item">
                                    <span>Date:</span>
                                    <span id="success-appointment-date">Not set</span>
                                </div>
                                <div class="order-detail-item">
                                    <span>Time:</span>
                                    <span id="success-appointment-time">Not set</span>
                                </div>
                                <div class="order-detail-item">
                                    <span>Service:</span>
                                    <span id="success-appointment-service">Not set</span>
                                </div>
                                <div class="order-detail-item">
                                    <span>Pet:</span>
                                    <span id="success-appointment-pet">Not set</span>
                                </div>
                            </div>

                            <div class="modal-footer">
                                <button class="btn btn-primary" onclick="viewAppointmentDetails()">
                                    View Appointment Details
                                </button>
                                <button class="btn btn-outline" onclick="closeAppointmentModal()">
                                    Close
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        `;
        document.body.appendChild(appointmentModal);
    }
}

function setupAppointmentForm() {
    const appointmentForm = document.getElementById('appointment-form');
    if (!appointmentForm) return;

    // Service change handler
    const serviceSelect = document.getElementById('appointment-service');
    if (serviceSelect) {
        serviceSelect.addEventListener('change', updateAppointmentSummary);
    }

    // Date change handler
    const dateInput = document.getElementById('appointment-date');
    if (dateInput) {
        // Set minimum date to today
        const today = new Date().toISOString().split('T')[0];
        dateInput.min = today;
        
        dateInput.addEventListener('change', function() {
            updateAvailableTimeSlots();
            updateAppointmentSummary();
        });
    }

    // Form submission
    appointmentForm.addEventListener('submit', function(e) {
        e.preventDefault();
        bookAppointment();
    });

    // Add pet button
    const addPetBtn = document.getElementById('add-pet-btn');
    if (addPetBtn) {
        addPetBtn.addEventListener('click', showAddPetModal);
    }

    // Pet selection change
    const petSelect = document.getElementById('appointment-pet');
    if (petSelect) {
        petSelect.addEventListener('change', updateAppointmentSummary);
    }
}

function setupPetManagement() {
    // Load user's pets when modal opens
    const appointmentModal = document.getElementById('appointment-modal');
    if (appointmentModal) {
        appointmentModal.addEventListener('click', function(e) {
            if (e.target.classList.contains('modal-overlay') || e.target.classList.contains('close-modal')) {
                loadUserPets();
            }
        });
    }
}

async function loadUserPets() {
    if (!AppState.currentUser) return;

    try {
        const snapshot = await db.collection('pets')
            .where('userId', '==', AppState.currentUser.uid)
            .orderBy('createdAt', 'desc')
            .get();

        AppState.userPets = [];
        snapshot.forEach(doc => {
            const pet = doc.data();
            pet.id = doc.id;
            AppState.userPets.push(pet);
        });

        updatePetSelection();
    } catch (error) {
        console.error('Error loading pets:', error);
        showNotification('Error loading your pets. Please try again.', 'error');
    }
}

function updatePetSelection() {
    const petSelect = document.getElementById('appointment-pet');
    const noPetsMessage = document.querySelector('.no-pets-message');
    
    if (!petSelect) return;

    // Clear existing options
    petSelect.innerHTML = '<option value="">Select a pet...</option>';
    
    if (AppState.userPets.length === 0) {
        if (noPetsMessage) {
            noPetsMessage.style.display = 'block';
        }
        petSelect.disabled = true;
    } else {
        if (noPetsMessage) {
            noPetsMessage.style.display = 'none';
        }
        petSelect.disabled = false;
        
        // Add pet options
        AppState.userPets.forEach(pet => {
            const option = document.createElement('option');
            option.value = pet.id;
            option.textContent = `${pet.name} (${pet.species} - ${pet.breed})`;
            petSelect.appendChild(option);
        });
    }
}

function showAddPetModal() {
    // Create or show add pet modal
    let addPetModal = document.getElementById('add-pet-modal');
    
    if (!addPetModal) {
        addPetModal = document.createElement('div');
        addPetModal.id = 'add-pet-modal';
        addPetModal.className = 'modal-overlay';
        addPetModal.innerHTML = `
            <div class="modal-dialog">
                <div class="modal-header">
                    <h2>Add New Pet</h2>
                    <button class="close-modal">&times;</button>
                </div>
                <div class="modal-body">
                    <form id="add-pet-form">
                        <div class="form-group">
                            <label for="pet-name">Pet Name *</label>
                            <input type="text" id="pet-name" name="name" required>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="pet-species">Species *</label>
                                <select id="pet-species" name="species" required>
                                    <option value="">Select species...</option>
                                    <option value="dog">Dog</option>
                                    <option value="cat">Cat</option>
                                    <option value="bird">Bird</option>
                                    <option value="rabbit">Rabbit</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="pet-breed">Breed *</label>
                                <input type="text" id="pet-breed" name="breed" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="pet-age">Age (years)</label>
                                <input type="number" id="pet-age" name="age" min="0" max="30" step="0.5">
                            </div>
                            <div class="form-group">
                                <label for="pet-gender">Gender</label>
                                <select id="pet-gender" name="gender">
                                    <option value="">Select gender...</option>
                                    <option value="male">Male</option>
                                    <option value="female">Female</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="pet-notes">Medical Notes (Optional)</label>
                            <textarea id="pet-notes" name="notes" rows="3" placeholder="Any existing medical conditions, allergies, or special requirements..."></textarea>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-outline" onclick="hideModal('add-pet-modal')">Cancel</button>
                            <button type="submit" class="btn btn-primary">Add Pet</button>
                        </div>
                    </form>
                </div>
            </div>
        `;
        document.body.appendChild(addPetModal);
        
        // Setup form submission
        const addPetForm = document.getElementById('add-pet-form');
        addPetForm.addEventListener('submit', addNewPet);
    }
    
    addPetModal.classList.add('active');
}

async function addNewPet(e) {
    e.preventDefault();
    
    if (!AppState.currentUser) {
        showNotification('Please log in to add pets', 'error');
        return;
    }
    
    const formData = new FormData(e.target);
    const petData = {
        userId: AppState.currentUser.uid,
        name: formData.get('name').trim(),
        species: formData.get('species'),
        breed: formData.get('breed').trim(),
        age: parseFloat(formData.get('age')) || 0,
        gender: formData.get('gender') || '',
        notes: formData.get('notes') || '',
        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
    };
    
    // Validate required fields
    if (!petData.name || !petData.species || !petData.breed) {
        showNotification('Please fill in all required fields', 'error');
        return;
    }
    
    try {
        showNotification('Adding your pet...', 'info');
        
        await db.collection('pets').add(petData);
        showNotification('Pet added successfully!', 'success');
        hideModal('add-pet-modal');
        
        // Reload pets and update selection
        await loadUserPets();
        
        // Clear form
        e.target.reset();
        
    } catch (error) {
        console.error('Error adding pet:', error);
        showNotification('Error adding pet: ' + error.message, 'error');
    }
}

function updateAvailableTimeSlots() {
    const dateInput = document.getElementById('appointment-date');
    const timeSlotsContainer = document.getElementById('time-slots');
    
    if (!dateInput || !timeSlotsContainer || !dateInput.value) return;
    
    // Generate time slots (9 AM to 5 PM, every 30 minutes)
    const timeSlots = [];
    for (let hour = 9; hour <= 17; hour++) {
        for (let minute = 0; minute < 60; minute += 30) {
            const timeString = `${hour.toString().padStart(2, '0')}:${minute.toString().padStart(2, '0')}`;
            timeSlots.push(timeString);
        }
    }
    
    // Mark some slots as unavailable (simulate booked appointments)
    // In a real app, you would check against existing appointments in the database
    const unavailableSlots = ['10:00', '11:30', '14:00']; // Example unavailable slots
    
    timeSlotsContainer.innerHTML = timeSlots.map(time => {
        const isUnavailable = unavailableSlots.includes(time);
        return `
            <div class="time-slot ${isUnavailable ? 'unavailable' : ''}" 
                 data-time="${time}" 
                 ${isUnavailable ? 'disabled' : ''}>
                ${time}
            </div>
        `;
    }).join('');
    
    // Add click listeners to time slots
    timeSlotsContainer.querySelectorAll('.time-slot:not(.unavailable)').forEach(slot => {
        slot.addEventListener('click', function() {
            // Deselect all slots
            timeSlotsContainer.querySelectorAll('.time-slot').forEach(s => {
                s.classList.remove('selected');
            });
            
            // Select clicked slot
            this.classList.add('selected');
            updateAppointmentSummary();
        });
    });
}

function updateAppointmentSummary() {
    const serviceSelect = document.getElementById('appointment-service');
    const dateInput = document.getElementById('appointment-date');
    const selectedTimeSlot = document.querySelector('.time-slot.selected');
    const petSelect = document.getElementById('appointment-pet');
    
    const summaryContainer = document.getElementById('appointment-summary');
    if (!summaryContainer) return;
    
    const serviceOption = serviceSelect?.selectedOptions[0];
    const servicePrice = serviceOption?.dataset.price ? parseInt(serviceOption.dataset.price) : 0;
    const serviceName = serviceOption?.textContent.split(' - ')[0] || 'Not selected';
    const date = dateInput?.value || 'Not selected';
    const time = selectedTimeSlot?.dataset.time || 'Not selected';
    const pet = petSelect?.selectedOptions[0]?.textContent || 'Not selected';
    
    summaryContainer.innerHTML = `
        <h4>Appointment Summary</h4>
        <div class="summary-item">
            <span>Service:</span>
            <span>${serviceName}</span>
        </div>
        <div class="summary-item">
            <span>Date:</span>
            <span>${date}</span>
        </div>
        <div class="summary-item">
            <span>Time:</span>
            <span>${time}</span>
        </div>
        <div class="summary-item">
            <span>Pet:</span>
            <span>${pet}</span>
        </div>
        <div class="summary-item summary-total">
            <span>Total:</span>
            <span>R${servicePrice}.00</span>
        </div>
    `;
    
    // Update book button state
    const bookBtn = document.getElementById('book-appointment-btn-final');
    if (bookBtn) {
        const canBook = servicePrice > 0 && date && time !== 'Not selected' && pet !== 'Not selected';
        bookBtn.disabled = !canBook;
    }
}

// Enhanced loadUserPets function with better error handling
async function loadUserPets() {
    if (!AppState.currentUser) {
        console.log('No user logged in, skipping pet load');
        return;
    }

    try {
        console.log('Loading pets for user:', AppState.currentUser.uid);
        
        // First, let's check if the pets collection exists and has data
        const petsRef = db.collection('pets');
        const snapshot = await petsRef
            .where('userId', '==', AppState.currentUser.uid)
            .get();

        console.log('Pets query completed, snapshot size:', snapshot.size);

        if (snapshot.empty) {
            console.log('No pets found for user');
            AppState.userPets = [];
            updatePetSelection();
            return;
        }

        AppState.userPets = [];
        snapshot.forEach(doc => {
            const pet = {
                id: doc.id,
                ...doc.data()
            };
            AppState.userPets.push(pet);
            console.log('Loaded pet:', pet.name, pet.id);
        });

        console.log('Successfully loaded pets:', AppState.userPets.length);
        updatePetSelection();
        
    } catch (error) {
        console.error('Error loading pets:', error);
        console.error('Error details:', {
            code: error.code,
            message: error.message,
            stack: error.stack
        });
        
        // Show more specific error message
        let errorMessage = 'Error loading your pets. Please try again.';
        
        if (error.code === 'permission-denied') {
            errorMessage = 'Permission denied. Please make sure you are logged in.';
        } else if (error.code === 'unavailable') {
            errorMessage = 'Network error. Please check your internet connection.';
        }
        
        showNotification(errorMessage, 'error');
    }
}

// Function to initialize sample pets for testing
async function initializeSamplePets() {
    if (!AppState.currentUser) {
        showNotification('Please log in to add sample pets', 'error');
        return;
    }

    try {
        showNotification('Adding sample pets...', 'info');

        const samplePets = [
            {
                userId: AppState.currentUser.uid,
                name: "Max",
                species: "dog",
                breed: "Golden Retriever",
                age: 3,
                gender: "male",
                notes: "Friendly and active",
                createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                updatedAt: firebase.firestore.FieldValue.serverTimestamp()
            },
            {
                userId: AppState.currentUser.uid,
                name: "Luna",
                species: "cat",
                breed: "Siamese",
                age: 2,
                gender: "female",
                notes: "Loves attention",
                createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                updatedAt: firebase.firestore.FieldValue.serverTimestamp()
            },
            {
                userId: AppState.currentUser.uid,
                name: "Buddy",
                species: "dog",
                breed: "Labrador",
                age: 5,
                gender: "male",
                notes: "Senior dog, needs special care",
                createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                updatedAt: firebase.firestore.FieldValue.serverTimestamp()
            }
        ];

        // Add pets to Firestore
        const batch = db.batch();
        samplePets.forEach(pet => {
            const docRef = db.collection('pets').doc();
            batch.set(docRef, pet);
        });

        await batch.commit();
        console.log('Sample pets added to Firebase');
        showNotification('Sample pets added successfully!', 'success');

        // Reload pets
        await loadUserPets();

    } catch (error) {
        console.error('Error adding sample pets:', error);
        showNotification('Error adding sample pets: ' + error.message, 'error');
    }
}

// Enhanced addNewPet function with better validation
async function addNewPet(e) {
    e.preventDefault();
    
    if (!AppState.currentUser) {
        showNotification('Please log in to add pets', 'error');
        return;
    }
    
    const formData = new FormData(e.target);
    const petData = {
        userId: AppState.currentUser.uid,
        name: formData.get('name').trim(),
        species: formData.get('species'),
        breed: formData.get('breed').trim(),
        age: parseFloat(formData.get('age')) || 0,
        gender: formData.get('gender') || '',
        notes: formData.get('notes') || '',
        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
    };
    
    // Validate required fields
    if (!petData.name) {
        showNotification('Please enter a pet name', 'error');
        return;
    }
    if (!petData.species) {
        showNotification('Please select a species', 'error');
        return;
    }
    if (!petData.breed) {
        showNotification('Please enter a breed', 'error');
        return;
    }
    
    try {
        showNotification('Adding your pet...', 'info');
        
        // Save to Firestore
        const docRef = await db.collection('pets').add(petData);
        console.log('Pet saved to Firebase with ID:', docRef.id);
        
        showNotification('Pet added successfully!', 'success');
        hideModal('add-pet-modal');
        
        // Reload pets and update selection
        await loadUserPets();
        
        // Clear form
        e.target.reset();
        
    } catch (error) {
        console.error('Error adding pet:', error);
        let errorMessage = 'Error adding pet. Please try again.';
        
        if (error.code === 'permission-denied') {
            errorMessage = 'Permission denied. You may not have permission to add pets.';
        }
        
        showNotification(errorMessage, 'error');
    }
}

// Function to check Firebase permissions and setup
async function checkFirebaseSetup() {
    try {
        console.log('Checking Firebase setup...');
        
        // Test if we can read from Firestore
        const testRef = db.collection('test');
        await testRef.limit(1).get();
        
        console.log('Firebase connection successful');
        return true;
    } catch (error) {
        console.error('Firebase setup check failed:', error);
        
        if (error.code === 'permission-denied') {
            console.error('Firestore permissions issue. Check your Firestore rules.');
            showNotification('Database permissions error. Please contact support.', 'error');
        } else if (error.code === 'unavailable') {
            console.error('Firebase unavailable - check internet connection');
            showNotification('Network error. Please check your internet connection.', 'error');
        }
        
        return false;
    }
}

// Enhanced updatePetSelection function
function updatePetSelection() {
    const petSelect = document.getElementById('appointment-pet');
    const noPetsMessage = document.querySelector('.no-pets-message');
    
    if (!petSelect) {
        console.error('Pet select element not found');
        return;
    }

    // Clear existing options
    petSelect.innerHTML = '<option value="">Select a pet...</option>';
    
    if (AppState.userPets.length === 0) {
        console.log('No pets available, showing add pet message');
        if (noPetsMessage) {
            noPetsMessage.style.display = 'block';
        }
        petSelect.disabled = true;
    } else {
        console.log('Adding pets to selection:', AppState.userPets.length);
        if (noPetsMessage) {
            noPetsMessage.style.display = 'none';
        }
        petSelect.disabled = false;
        
        // Add pet options
        AppState.userPets.forEach(pet => {
            const option = document.createElement('option');
            option.value = pet.id;
            option.textContent = `${pet.name} (${pet.species} - ${pet.breed})`;
            petSelect.appendChild(option);
        });
    }
    
    // Update appointment summary if form is open
    updateAppointmentSummary();
}

// Function to manually refresh pets
async function refreshPets() {
    showNotification('Refreshing pets...', 'info');
    await loadUserPets();
}

// Enhanced initialization with Firebase checks
async function initializeAppointmentSystem() {
    console.log('Initializing appointment system...');
    
    // Check Firebase setup first
    const firebaseReady = await checkFirebaseSetup();
    if (!firebaseReady) {
        showNotification('Database connection issue. Some features may not work.', 'warning');
        return;
    }
    
    setupAppointmentBooking();
    
    // Load pets when user logs in
    auth.onAuthStateChanged((user) => {
        if (user) {
            console.log('User logged in, loading pets...');
            loadUserPets();
            updateAppointmentsCollection();
        } else {
            console.log('User logged out, clearing pets...');
            AppState.userPets = [];
            updatePetSelection();
        }
    });
}

// Debug function to check current state
function debugPets() {
    console.log('Current pets state:', {
        userPets: AppState.userPets,
        currentUser: AppState.currentUser,
        petsCount: AppState.userPets.length
    });
}

// Make functions globally available for testing
window.initializeSamplePets = initializeSamplePets;
window.refreshPets = refreshPets;
window.debugPets = debugPets;
window.checkFirebaseSetup = checkFirebaseSetup;

// Initialize the appointment system
document.addEventListener('DOMContentLoaded', function() {
    console.log('DOM loaded, initializing appointment system...');
    initializeAppointmentSystem();
});

// Main Book Appointment Function
async function bookAppointment() {
    if (!AppState.currentUser) {
        showNotification('Please log in to book an appointment', 'error');
        return;
    }
    
    const serviceSelect = document.getElementById('appointment-service');
    const dateInput = document.getElementById('appointment-date');
    const selectedTimeSlot = document.querySelector('.time-slot.selected');
    const petSelect = document.getElementById('appointment-pet');
    const notesInput = document.getElementById('appointment-notes');
    
    // Validation
    if (!serviceSelect.value || !dateInput.value || !selectedTimeSlot || !petSelect.value) {
        showNotification('Please fill in all required fields', 'error');
        return;
    }
    
    const serviceOption = serviceSelect.selectedOptions[0];
    const selectedPet = AppState.userPets.find(pet => pet.id === petSelect.value);
    
    if (!selectedPet) {
        showNotification('Selected pet not found', 'error');
        return;
    }
    
    const appointmentData = {
        userId: AppState.currentUser.uid,
        userEmail: AppState.currentUser.email,
        userName: AppState.currentUser.displayName,
        service: serviceSelect.value,
        serviceName: serviceOption.textContent.split(' - ')[0],
        price: parseInt(serviceOption.dataset.price),
        date: dateInput.value,
        time: selectedTimeSlot.dataset.time,
        petId: petSelect.value,
        petName: selectedPet.name,
        petSpecies: selectedPet.species,
        petBreed: selectedPet.breed,
        notes: notesInput?.value || '',
        status: 'confirmed',
        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
    };
    
    try {
        // Show processing state
        showAppointmentProcessing(true);
        
        // Check for existing appointments at the same time
        const existingAppointments = await db.collection('appointments')
            .where('date', '==', appointmentData.date)
            .where('time', '==', appointmentData.time)
            .where('status', 'in', ['confirmed', 'pending'])
            .get();
        
        if (!existingAppointments.empty) {
            showNotification('This time slot is already booked. Please choose another time.', 'error');
            showAppointmentProcessing(false);
            return;
        }
        
        // Save to Firestore
        const docRef = await db.collection('appointments').add(appointmentData);
        
        // Add to local state
        appointmentData.id = docRef.id;
        appointmentData.appointmentNumber = `APT-${Date.now()}`;
        AppState.userAppointments.unshift(appointmentData);
        
        // Show success
        showAppointmentSuccess(appointmentData);
        
        // Send confirmation (in a real app, you might send an email)
        sendAppointmentConfirmation(appointmentData);
        
    } catch (error) {
        console.error('Error booking appointment:', error);
        showNotification('Error booking appointment: ' + error.message, 'error');
        showAppointmentProcessing(false);
    }
}

function showAppointmentProcessing(show) {
    const step1 = document.getElementById('appointment-step-1');
    const processing = document.getElementById('appointment-processing');
    
    if (show) {
        step1.style.display = 'none';
        processing.style.display = 'block';
    } else {
        step1.style.display = 'block';
        processing.style.display = 'none';
    }
}

function showAppointmentSuccess(appointment) {
    const processing = document.getElementById('appointment-processing');
    const success = document.getElementById('appointment-success');
    
    processing.style.display = 'none';
    success.style.display = 'block';
    
    // Format date for display
    const appointmentDate = new Date(appointment.date);
    const formattedDate = appointmentDate.toLocaleDateString('en-ZA', {
        weekday: 'long',
        year: 'numeric',
        month: 'long',
        day: 'numeric'
    });
    
    // Update success details
    document.getElementById('success-appointment-number').textContent = appointment.appointmentNumber;
    document.getElementById('success-appointment-date').textContent = formattedDate;
    document.getElementById('success-appointment-time').textContent = appointment.time;
    document.getElementById('success-appointment-service').textContent = appointment.serviceName;
    document.getElementById('success-appointment-pet').textContent = appointment.petName;
}

function sendAppointmentConfirmation(appointment) {
    // In a real application, you would send an email here
    // For now, we'll just log it and show a notification
    console.log('Appointment confirmation would be sent:', appointment);
    
    // You could integrate with an email service like SendGrid, Mailgun, etc.
    // Example:
    // await emailService.send({
    //   to: appointment.userEmail,
    //   subject: `Appointment Confirmation - ${appointment.appointmentNumber}`,
    //   template: 'appointment-confirmation',
    //   data: appointment
    // });
}

function viewAppointmentDetails() {
    closeAppointmentModal();
    // In a real implementation, this would navigate to the appointments page
    showNotification('Appointment booked successfully! You can view all your appointments in the "My Appointments" section.', 'success');
}

function closeAppointmentModal() {
    hideModal('appointment-modal');
    resetAppointmentForm();
}

function resetAppointmentForm() {
    const form = document.getElementById('appointment-form');
    if (form) form.reset();
    
    const timeSlots = document.getElementById('time-slots');
    if (timeSlots) timeSlots.innerHTML = '';
    
    const summary = document.getElementById('appointment-summary');
    if (summary) summary.innerHTML = '';
    
    // Reset UI states
    showAppointmentProcessing(false);
    const success = document.getElementById('appointment-success');
    if (success) success.style.display = 'none';
    
    const step1 = document.getElementById('appointment-step-1');
    if (step1) step1.style.display = 'block';
}

// Initialize appointment functionality when DOM is loaded
document.addEventListener('DOMContentLoaded', function() {
    setupAppointmentBooking();
    
    // Load pets when user logs in
    auth.onAuthStateChanged((user) => {
        if (user) {
            loadUserPets();
        }
    });
    
    // Setup book appointment button
    const bookAppointmentBtn = document.getElementById('book-appointment-btn');
    if (bookAppointmentBtn) {
        bookAppointmentBtn.addEventListener('click', function() {
            if (!AppState.currentUser) {
                showNotification('Please log in to book an appointment', 'warning');
                showModal('login-modal');
                return;
            }
            
            // Load pets and show appointment modal
            loadUserPets().then(() => {
                showModal('appointment-modal');
                // Generate initial time slots for today
                updateAvailableTimeSlots();
            });
        });
    }
});

// Make functions globally available
window.showAddPetModal = showAddPetModal;
window.addNewPet = addNewPet;
window.viewAppointmentDetails = viewAppointmentDetails;
window.closeAppointmentModal = closeAppointmentModal;
    </script>
</body>
</html>